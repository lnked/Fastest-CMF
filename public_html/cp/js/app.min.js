var app = app || {};

(function(body){
    "use strict";

    app = {
        
        init: function()
        {
            this.history.init();
            
            // var container = document.querySelector('.gallery');

            // container.addEventListener('click', function(e) {
            //   if (e.target != e.currentTarget) {
            //     e.preventDefault();
            //     // e.target is the image inside the link we just clicked.
            //   }
            //   e.stopPropagation();
            // }, false);

            // window.addEventListener('popstate', function(e) {
            //   // e.state is equal to the data-attribute of the last image we clicked
            // });
        }

    };

})(document.body);

// cookie.set({
//    key1: 'value1',
//    key2: 'value2'
// });

// cookie.set('key', 'value', {
//    expires: 7, // expires in one week
// });

// cookie.set({
//    key1: 'value1',
//    key2: 'value2'
// }, {
//    expires: 7
// })

// cookie.defaults.expires = 7;
// cookie.defaults.secure = true;


// cookie.expiresMultiplier = 60; // Seconds.
// cookie.expiresMultiplier = 60 * 60; // Minutes.
// cookie.expiresMultiplier = 60 * 60 * 24; // Hours.


// cookie.get('key');

// cookie.get(['key1', 'key2']);

// cookie.get('key', 'default value');
// cookie.get(['key1', 'key2'], 'default value');


// cookie.get('key');
// // is the same as
// cookie('key');

// var cookies = cookie.all();

// cookie.remove('key');
// cookie.remove('key1', 'key2');
// cookie.remove(['key1', 'key2']);

// if (cookie.enabled()) {
//    // Do stuff with cookies
// } else {
//    // Display error message or use localStorage
// }


// cookie.set('a', '1');
// cookie.setDefault({
//    a: '2',
//    b: '2'
// });

// cookie.get(['a', 'b']); // {a: "1", b: "2"}

// cookie.set('a', 'b', { path: '/somepath' });

// // This won't work
// cookie.remove('a');

// // You have to do this
// cookie.removeSpecific('a', { path: '/somepath' });

// // You can also give an array of cookie keys
// cookie.removeSpecific(['a', 'b'], { path: '/somepath' });

// cookie.empty().set('key1', 'value1').set('key2', 'value2').remove('key1');

// cookie.utils.decode = function (value) {
//    return decodeURIComponent(value).replace('+', ' ');
// };

var app = app || {};

(function(body){
    "use strict";

    // // Prepare
    // var History = window.History; // Note: We are using a capital H instead of a lower h
    // if ( !History.enabled ) {
    //      // History.js is disabled for this browser.
    //      // This is because we can optionally choose to support HTML4 browsers or not.
    //     return false;
    // }

    // // Bind to StateChange Event
    // History.Adapter.bind(window,'statechange',function() { // Note: We are using statechange instead of popstate
    //     var State = History.getState();
    //     $('#content').load(State.url);
    //     /* Instead of the line above, you could run the code below if the url returns the whole page instead of just the content (assuming it has a `#content`): */
    //     $.get(State.url, function(response) {
    //         $('#content').html($(response).find('#content').html()); });
    //     });


    // // Capture all the links to push their url to the history stack and trigger the StateChange Event
    // $('a').click(function(evt) {
    //     evt.preventDefault();
    //     History.pushState(null, $(this).text(), $(this).attr('href'));
    // });

    app.history = {
        
        init: function()
        {
            // function requestContent(file) {
            //   $('.wrapper__content').load(file + ' .wrapper__content');
            // }

            // window.addEventListener('popstate', function(e) {
            //   var character = e.state;

            //   if (character == null) {
            //     removeCurrentClass();
            //     textWrapper.innerHTML = " ";
            //     content.innerHTML = " ";
            //     document.title = defaultTitle;
            //   } else {
            //       updateText(character);
            //       requestContent(character + ".html");
            //       addCurrentClass(character);
            //       document.title = "Ghostbuster | " + character;
            //   }
            // });

            History = window.history;

            console.log(window.History, History, History.enabled);

            window.history.pushState({}, null, '/cp/site/edik');

            // // Bind to StateChange Event
            History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
                var State = History.getState(); // Note: We are using History.getState() instead of event.state
            });

            // // Change our States
            History.pushState({state:1}, "State 1", "?state=1"); // logs {state:1}, "State 1", "?state=1"
            History.pushState({state:2}, "State 2", "?state=2"); // logs {state:2}, "State 2", "?state=2"
            History.replaceState({state:3}, "State 3", "?state=3"); // logs {state:3}, "State 3", "?state=3"
            History.pushState(null, null, "?state=4"); // logs {}, '', "?state=4"
            History.back(); // logs {state:3}, "State 3", "?state=3"
            History.back(); // logs {state:1}, "State 1", "?state=1"
            History.back(); // logs {}, "Home Page", "?"
            History.go(2); // logs {state:3}, "State 3", "?state=3"
            
            /*  Инициализируем контейнер для записей */
            var $entries = $(".wrapper__content");

            /* Вешаем обработчики onlick на ссылки */
            var $page_links = $(".nav"),
                $prev_link = $page_links.find("a.nav__item__link"),
                $next_link = $page_links.find("a.nav__item__link");
            $page_links.delegate("a", "click", function (e) {
                e.preventDefault();
                var url = $(this).attr("href");

                /*  Удаляем текущие записи из контейнера */
                $entries.empty();

                /*  Показываем индикатор загрузки */
                $entries.addClass("loading");

                /*  И сообщаем History.js об изменении состояния страницы
                В качестве первого агрумента можно передать произвольный объект
                с дополнительными данными, которые можно извлечь в обработчике
                изменения состояния, описанном ниже.
                В нашем случае это будет пустой объект. */
                History.pushState({}, null, url);
            });

            /*  Готовим обработчик изменения состояния страницы */
            History.Adapter.bind(window, "statechange", function () {
                /*  Получаем информацию о состоянии страницы */
                var state = History.getState();

                /* Получаем URL нового состояния. Это URL, который мы передали
                в .pushState() */
                var url = state.url;

                /*  Тут можно извлечь дополнительные данные, о которых шла речь выше.
                Например, так: var data = state.data; */

                /*  Отправляем AJAX-запрос на сервер.
                В качестве ответа мы ожидаем JSON-объект следующего формата:
                {entries: "<article><h1>...</h1>...</article> <article>...",
                 title: "Страница 3",
                 next_url: "/blog/page/4",
                 prev_url: "/blog/page/2" }
                Каким образом будет сформирован этот ответ, зависит только от вас. */
                $.getJSON(url, function (response) {

                    /*  Обновляем заголовок страницы */
                    $("title").text(response.title);

                    /*  Обновляем ссылки на предыдущую и следующую страницы */
                    $prev_link.attr("href", response.prev_url);
                    $next_link.attr("href", response.next_url);

                    /*  И, наконец, показываем новый блок записей */
                    $entries.removeClass("loading").html(response.entries);
                });
            });
        }

    };

})(document.body);

// (function(window,undefined){

//     // Check Location
//     if ( document.location.protocol === 'file:' ) {
//         alert('The HTML5 History API (and thus History.js) do not work on files, please upload it to a server.');
//     }

//     // Establish Variables
//     var
//         History = window.History, // Note: We are using a capital H instead of a lower h
//         State = History.getState(),
//         $log = $('#log');

//     // Log Initial State
//     History.log('initial:', State.data, State.title, State.url);

//     // Bind to State Change
//     History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
//         // Log the State
//         var State = History.getState(); // Note: We are using History.getState() instead of event.state
//         History.log('statechange:', State.data, State.title, State.url);
//     });

//     // Prepare Buttons
//     var
//         buttons = document.getElementById('buttons'),
//         scripts = [
//             'History.pushState({state:1,rand:Math.random()}, "State 1", "?state=1"); // logs {state:1,rand:"some random value"}, "State 1", "?state=1"',
//             'History.pushState({state:2,rand:Math.random()}, "State 2", "?state=2"); // logs {state:2,rand:"some random value"}, "State 2", "?state=2"',
//             'History.replaceState({state:3,rand:Math.random()}, "State 3", "?state=3"); // logs {state:3,rand:"some random value"}, "State 3", "?state=3"',
//             'History.pushState(null, null, "?state=4"); // logs {}, "", "?state=4"',
//             'History.back(); // logs {state:3}, "State 3", "?state=3"',
//             'History.back(); // logs {state:1}, "State 1", "?state=1"',
//             'History.back(); // logs {}, "The page you started at", "?"',
//             'History.go(2); // logs {state:3}, "State 3", "?state=3"'
//         ],
//         buttonsHTML = ''
//         ;

//     // Add Buttons
//     for ( var i=0,n=scripts.length; i<n; ++i ) {
//         var _script = scripts[i];
//         buttonsHTML +=
//             '<li><button onclick=\'javascript:'+_script+'\'>'+_script+'</button></li>';
//     }
//     buttons.innerHTML = buttonsHTML;

// })(window);
var app = app || {};

(function(body){
    "use strict";

    app.preload = {

        preload: function($image)
        {
            var url = $image.data('preload'), image = null;

            try {
                image = new Image();
                image.onload = function() {
                    $image.attr('src', url);
                };
                image.src = url;
            }
            catch (e) {
                $image.attr('src', url);
            }
            
            $image.removeAttr('width height');
            $image.data('preload', '');
        },

        init: function()
        {
            if ($('img[data-preload]').length)
            {
                var _this = this;
            
                $('img[data-preload]').each(function(){
                    (function($image){
                        _this.preload($image);
                    })($(this))
                });
            }
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.quantity = {

        config: {
            element: '.j-quantity',
            input: '.j-quantity-count',
            control: '.j-quantity-control',
            complete: null
        },

        element: null,

        extend: function(config)
        {
            var _this = this;

            if (typeof config !== 'undefined')
            {
                var x;
                for (x in config)
                {
                    if (typeof _this.config[x] !== 'undefined')
                        _this.config[x] = config[x];
                }
            }
        },

        setValue: function(quantity)
        {
            var min = 1, max = 100;

            if (this.element.data('min')) {
                min = this.element.data('min');   
            }
            
            if (this.element.data('max')) {
                max = this.element.data('max');   
            }

            if (quantity > max) {
                quantity = max;
            }
            
            if (quantity < min) {
                quantity = min;
            }

            this.element.find(this.config.input).val(quantity);

        },

        increase: function(quantity)
        {
            quantity += 1;

            this.setValue(quantity);
        },

        decrease: function(quantity)
        {
            if (quantity > 1) {
                quantity -= 1;
            }

            this.setValue(quantity);
        },

        callback: function()
        {
            if (typeof(this.element.data('product')) !== 'undefined' && typeof(this.config.complete) == 'function')
            {
                this.config.complete.call(null, this.element, this.element.data('product'));
            }
        },

        keys: function()
        {
            var _this = this, role = '';

            $('body').on('keydown', _this.config.input, function(e) {
                if ([38, 40].indexOf(e.keyCode) >= 0)
                {
                    e.preventDefault();

                    role = {
                        38: 'increase',
                        40: 'decrease'
                    };

                    _this.element = $(this).closest(_this.config.element);

                    _this[role[e.keyCode]](parseInt(_this.element.find(_this.config.input).val()));

                    _this.callback();

                    return false;
                }
            });
        },

        bind: function()
        {
            var _this = this, role = '';

            $('body').on('click', _this.config.control, function(e) {
                e.preventDefault();

                _this.element = $(this).closest(_this.config.element);

                role = $(this).data('role');
         
                if(['increase', 'decrease'].indexOf(role) >= 0)
                {
                    _this[role](parseInt(_this.element.find(_this.config.input).val()));
                }

                _this.callback();

                return !1;
            });
        },

        init: function(config)
        {
            if (typeof config !== 'undefined')
            {
                this.extend(config);
            }

            this.bind();
            this.keys();
        }

    };

})(document.body);

// this.quantity.init({
//     complete: function(element, id) {
//         // $(element).css({
//         //     'border': '1px solid lime'
//         // });

//         console.log("id :", id);
//     }
// });

// <div class="quantity j-quantity clearfix" data-product="1000" data-min="1" data-max="999">
//     <button type="button" class="quantity__control _decrease j-quantity-control" data-role="decrease"></button>
//     <input type="text" name="count[1000]" value="1" data-role="quantity-input" class="quantity__count j-quantity-count" maxlength="3" autocomplete="off">
//     <button type="button" class="quantity__control _increase j-quantity-control" data-role="increase"></button>
// </div>
var app = app || {};

;(function(body){
    "use strict";

    var _this;

    app.sandwich = {

        config: {
            keyHooks: !1,
            selector: '.js-sandwich-menu',
            wrapper: '.layout-wrapper',
            overlay: '.overlay'
        },

        extend: function(config)
        {
            _this = this;

            if (typeof config !== 'undefined')
            {
                var x;
                for (x in config)
                {
                    if (typeof _this.config[x] !== 'undefined')
                        _this.config[x] = config[x];
                }
            }
        },

        isOpen: function()
        {
            return $('body').hasClass('page-visible');
        },

        hide: function()
        {
            $('body').removeClass('page-open');

            setTimeout(function(){
                $('body').removeClass('page-visible');
            }, 10);

            $(this.config.overlay).css({
                'visibility': 'hidden'
            });
        },

        toggle: function()
        {
            if ($('body').hasClass('page-visible'))
            {
                $('body').removeClass('page-open');

                setTimeout(function(){
                    $('body').removeClass('page-visible');
                }, 200);
            }
            else
            {
                $('body').addClass('page-open');

                setTimeout(function(){
                    $('body').addClass('page-visible');
                }, 10);
            }

            var visibility = 'visible';

            if (!$('body').hasClass('page-open'))
            {
                visibility = 'hidden'
            }
            
            $(_this.config.overlay).css({
                'visibility': visibility
            });
        },

        sandwichTrigger: function()
        {
            _this = this;

            if (_this.config.keyHooks)
            {
                $('body').on('keydown', function(e) {
                    if(e.keyCode == 27 && _this.isOpen())
                    {
                        _this.toggle();
                    }
                });
            };

            $('body').on('click', _this.config.selector, function(e){
                e.preventDefault ? e.preventDefault() : e.returnValue = false;
                _this.toggle();
            });
        },

        overlayTrigger: function()
        {
            _this = this;

            $('body').on('click', _this.config.overlay, function(e){
                _this.hide();
            });
        },

        init: function(config)
        {
            this.extend(config);
            this.sandwichTrigger();
            this.overlayTrigger();
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.tabs = {

        init: function() {
            var $wrapper = null, tab = '';

            $('body').on('click', '.j-tab-trigger', function(e){
                e.preventDefault();

                if (!$(this).hasClass('_open')) {
                    tab = $(this).data('tab');

                    $wrapper = $(this).closest('.j-tab-wrapper');

                    $wrapper.find('.j-tab-trigger').removeClass('_current');
                    $wrapper.find('.j-tab-item').removeClass('_open');

                    $wrapper.find('#tab-'+tab).addClass('_open');
                    $(this).addClass('_current');
                }

                return !1;
            });
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.toggle = {
        
        init: function() {
            
            var $toggle = null, text = '', hide = true, remove = false;

            $('body').on('click', '.j-toggle-trigger', function(e){
                e.preventDefault();

                $toggle = $(this).closest('.j-toggle').find('.j-toggle-item');

                if ($toggle)
                {
                    $toggle.toggleClass('is-show');
                }

                if ($toggle.hasClass('is-hidden'))
                {
                    $toggle.removeClass('is-hidden');
                }

                if ($(this).data('toggle-text')) {
                    text = $(this).data('toggle-text');
                }

                if (typeof($(this).data('remove')) !== 'undefined') {
                    remove = $(this).data('remove') == '0' ? false : ($(this).data('remove') == '1' ? true : false);
                }
                
                if (hide) {
                    $(this).hide();
                }
                
                if (remove) {
                    $(this).remove();
                }

                if (text) {
                    $(this).data('toggle-text', $(this).html());
                    $(this).html(text);
                }

                return false;
            })

        }

    };

})(document.body);

// <div class="j-toggle">
//     <div class="j-toggle-item"> content </div>
//     <span class="j-toggle-trigger" data-toggle-text="Скрыть..." data-hide="1" data-remove="1">Еще...</span>
// </div>
"use strict";

function __() {try {for(var i=0; i<arguments.length; i++) {console.log(arguments[i]);}}catch (e) {}}

function sprintf(v) {
  var split = v.toString().split('.'), pad = "00", time = [], x = null;

  for (x in split) {
    time.push(pad.substring(0, 2 - split[x].toString().length) + split[x]);
  }

  return time.join('.');
}
$(document).ready(function() {
    app.init();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9fYXBwLmpzIiwiX2FwcC5oaXN0b3J5LmpzIiwiX2FwcC5wcmVsb2FkLmpzIiwiX2FwcC5xdWFudGl0eS5qcyIsIl9hcHAuc2FuZHdpY2guanMiLCJfYXBwLnRhYnMuanMiLCJfYXBwLnRvZ2dsZS5qcyIsIl9mdW5jdGlvbnMuanMiLCJpbml0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICBhcHAgPSB7XG4gICAgICAgIFxuICAgICAgICBpbml0OiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5pbml0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FsbGVyeScpO1xuXG4gICAgICAgICAgICAvLyBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAvLyAgIGlmIChlLnRhcmdldCAhPSBlLmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgICAgICAgIC8vICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAvLyAgICAgLy8gZS50YXJnZXQgaXMgdGhlIGltYWdlIGluc2lkZSB0aGUgbGluayB3ZSBqdXN0IGNsaWNrZWQuXG4gICAgICAgICAgICAvLyAgIH1cbiAgICAgICAgICAgIC8vICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIC8vIH0sIGZhbHNlKTtcblxuICAgICAgICAgICAgLy8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgLy8gICAvLyBlLnN0YXRlIGlzIGVxdWFsIHRvIHRoZSBkYXRhLWF0dHJpYnV0ZSBvZiB0aGUgbGFzdCBpbWFnZSB3ZSBjbGlja2VkXG4gICAgICAgICAgICAvLyB9KTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7XG5cbi8vIGNvb2tpZS5zZXQoe1xuLy8gICAga2V5MTogJ3ZhbHVlMScsXG4vLyAgICBrZXkyOiAndmFsdWUyJ1xuLy8gfSk7XG5cbi8vIGNvb2tpZS5zZXQoJ2tleScsICd2YWx1ZScsIHtcbi8vICAgIGV4cGlyZXM6IDcsIC8vIGV4cGlyZXMgaW4gb25lIHdlZWtcbi8vIH0pO1xuXG4vLyBjb29raWUuc2V0KHtcbi8vICAgIGtleTE6ICd2YWx1ZTEnLFxuLy8gICAga2V5MjogJ3ZhbHVlMidcbi8vIH0sIHtcbi8vICAgIGV4cGlyZXM6IDdcbi8vIH0pXG5cbi8vIGNvb2tpZS5kZWZhdWx0cy5leHBpcmVzID0gNztcbi8vIGNvb2tpZS5kZWZhdWx0cy5zZWN1cmUgPSB0cnVlO1xuXG5cbi8vIGNvb2tpZS5leHBpcmVzTXVsdGlwbGllciA9IDYwOyAvLyBTZWNvbmRzLlxuLy8gY29va2llLmV4cGlyZXNNdWx0aXBsaWVyID0gNjAgKiA2MDsgLy8gTWludXRlcy5cbi8vIGNvb2tpZS5leHBpcmVzTXVsdGlwbGllciA9IDYwICogNjAgKiAyNDsgLy8gSG91cnMuXG5cblxuLy8gY29va2llLmdldCgna2V5Jyk7XG5cbi8vIGNvb2tpZS5nZXQoWydrZXkxJywgJ2tleTInXSk7XG5cbi8vIGNvb2tpZS5nZXQoJ2tleScsICdkZWZhdWx0IHZhbHVlJyk7XG4vLyBjb29raWUuZ2V0KFsna2V5MScsICdrZXkyJ10sICdkZWZhdWx0IHZhbHVlJyk7XG5cblxuLy8gY29va2llLmdldCgna2V5Jyk7XG4vLyAvLyBpcyB0aGUgc2FtZSBhc1xuLy8gY29va2llKCdrZXknKTtcblxuLy8gdmFyIGNvb2tpZXMgPSBjb29raWUuYWxsKCk7XG5cbi8vIGNvb2tpZS5yZW1vdmUoJ2tleScpO1xuLy8gY29va2llLnJlbW92ZSgna2V5MScsICdrZXkyJyk7XG4vLyBjb29raWUucmVtb3ZlKFsna2V5MScsICdrZXkyJ10pO1xuXG4vLyBpZiAoY29va2llLmVuYWJsZWQoKSkge1xuLy8gICAgLy8gRG8gc3R1ZmYgd2l0aCBjb29raWVzXG4vLyB9IGVsc2Uge1xuLy8gICAgLy8gRGlzcGxheSBlcnJvciBtZXNzYWdlIG9yIHVzZSBsb2NhbFN0b3JhZ2Vcbi8vIH1cblxuXG4vLyBjb29raWUuc2V0KCdhJywgJzEnKTtcbi8vIGNvb2tpZS5zZXREZWZhdWx0KHtcbi8vICAgIGE6ICcyJyxcbi8vICAgIGI6ICcyJ1xuLy8gfSk7XG5cbi8vIGNvb2tpZS5nZXQoWydhJywgJ2InXSk7IC8vIHthOiBcIjFcIiwgYjogXCIyXCJ9XG5cbi8vIGNvb2tpZS5zZXQoJ2EnLCAnYicsIHsgcGF0aDogJy9zb21lcGF0aCcgfSk7XG5cbi8vIC8vIFRoaXMgd29uJ3Qgd29ya1xuLy8gY29va2llLnJlbW92ZSgnYScpO1xuXG4vLyAvLyBZb3UgaGF2ZSB0byBkbyB0aGlzXG4vLyBjb29raWUucmVtb3ZlU3BlY2lmaWMoJ2EnLCB7IHBhdGg6ICcvc29tZXBhdGgnIH0pO1xuXG4vLyAvLyBZb3UgY2FuIGFsc28gZ2l2ZSBhbiBhcnJheSBvZiBjb29raWUga2V5c1xuLy8gY29va2llLnJlbW92ZVNwZWNpZmljKFsnYScsICdiJ10sIHsgcGF0aDogJy9zb21lcGF0aCcgfSk7XG5cbi8vIGNvb2tpZS5lbXB0eSgpLnNldCgna2V5MScsICd2YWx1ZTEnKS5zZXQoJ2tleTInLCAndmFsdWUyJykucmVtb3ZlKCdrZXkxJyk7XG5cbi8vIGNvb2tpZS51dGlscy5kZWNvZGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbi8vICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpLnJlcGxhY2UoJysnLCAnICcpO1xuLy8gfTtcbiIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vIC8vIFByZXBhcmVcbiAgICAvLyB2YXIgSGlzdG9yeSA9IHdpbmRvdy5IaXN0b3J5OyAvLyBOb3RlOiBXZSBhcmUgdXNpbmcgYSBjYXBpdGFsIEggaW5zdGVhZCBvZiBhIGxvd2VyIGhcbiAgICAvLyBpZiAoICFIaXN0b3J5LmVuYWJsZWQgKSB7XG4gICAgLy8gICAgICAvLyBIaXN0b3J5LmpzIGlzIGRpc2FibGVkIGZvciB0aGlzIGJyb3dzZXIuXG4gICAgLy8gICAgICAvLyBUaGlzIGlzIGJlY2F1c2Ugd2UgY2FuIG9wdGlvbmFsbHkgY2hvb3NlIHRvIHN1cHBvcnQgSFRNTDQgYnJvd3NlcnMgb3Igbm90LlxuICAgIC8vICAgICByZXR1cm4gZmFsc2U7XG4gICAgLy8gfVxuXG4gICAgLy8gLy8gQmluZCB0byBTdGF0ZUNoYW5nZSBFdmVudFxuICAgIC8vIEhpc3RvcnkuQWRhcHRlci5iaW5kKHdpbmRvdywnc3RhdGVjaGFuZ2UnLGZ1bmN0aW9uKCkgeyAvLyBOb3RlOiBXZSBhcmUgdXNpbmcgc3RhdGVjaGFuZ2UgaW5zdGVhZCBvZiBwb3BzdGF0ZVxuICAgIC8vICAgICB2YXIgU3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlKCk7XG4gICAgLy8gICAgICQoJyNjb250ZW50JykubG9hZChTdGF0ZS51cmwpO1xuICAgIC8vICAgICAvKiBJbnN0ZWFkIG9mIHRoZSBsaW5lIGFib3ZlLCB5b3UgY291bGQgcnVuIHRoZSBjb2RlIGJlbG93IGlmIHRoZSB1cmwgcmV0dXJucyB0aGUgd2hvbGUgcGFnZSBpbnN0ZWFkIG9mIGp1c3QgdGhlIGNvbnRlbnQgKGFzc3VtaW5nIGl0IGhhcyBhIGAjY29udGVudGApOiAqL1xuICAgIC8vICAgICAkLmdldChTdGF0ZS51cmwsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgLy8gICAgICAgICAkKCcjY29udGVudCcpLmh0bWwoJChyZXNwb25zZSkuZmluZCgnI2NvbnRlbnQnKS5odG1sKCkpOyB9KTtcbiAgICAvLyAgICAgfSk7XG5cblxuICAgIC8vIC8vIENhcHR1cmUgYWxsIHRoZSBsaW5rcyB0byBwdXNoIHRoZWlyIHVybCB0byB0aGUgaGlzdG9yeSBzdGFjayBhbmQgdHJpZ2dlciB0aGUgU3RhdGVDaGFuZ2UgRXZlbnRcbiAgICAvLyAkKCdhJykuY2xpY2soZnVuY3Rpb24oZXZ0KSB7XG4gICAgLy8gICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vICAgICBIaXN0b3J5LnB1c2hTdGF0ZShudWxsLCAkKHRoaXMpLnRleHQoKSwgJCh0aGlzKS5hdHRyKCdocmVmJykpO1xuICAgIC8vIH0pO1xuXG4gICAgYXBwLmhpc3RvcnkgPSB7XG4gICAgICAgIFxuICAgICAgICBpbml0OiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIC8vIGZ1bmN0aW9uIHJlcXVlc3RDb250ZW50KGZpbGUpIHtcbiAgICAgICAgICAgIC8vICAgJCgnLndyYXBwZXJfX2NvbnRlbnQnKS5sb2FkKGZpbGUgKyAnIC53cmFwcGVyX19jb250ZW50Jyk7XG4gICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgIC8vIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIC8vICAgdmFyIGNoYXJhY3RlciA9IGUuc3RhdGU7XG5cbiAgICAgICAgICAgIC8vICAgaWYgKGNoYXJhY3RlciA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyAgICAgcmVtb3ZlQ3VycmVudENsYXNzKCk7XG4gICAgICAgICAgICAvLyAgICAgdGV4dFdyYXBwZXIuaW5uZXJIVE1MID0gXCIgXCI7XG4gICAgICAgICAgICAvLyAgICAgY29udGVudC5pbm5lckhUTUwgPSBcIiBcIjtcbiAgICAgICAgICAgIC8vICAgICBkb2N1bWVudC50aXRsZSA9IGRlZmF1bHRUaXRsZTtcbiAgICAgICAgICAgIC8vICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vICAgICAgIHVwZGF0ZVRleHQoY2hhcmFjdGVyKTtcbiAgICAgICAgICAgIC8vICAgICAgIHJlcXVlc3RDb250ZW50KGNoYXJhY3RlciArIFwiLmh0bWxcIik7XG4gICAgICAgICAgICAvLyAgICAgICBhZGRDdXJyZW50Q2xhc3MoY2hhcmFjdGVyKTtcbiAgICAgICAgICAgIC8vICAgICAgIGRvY3VtZW50LnRpdGxlID0gXCJHaG9zdGJ1c3RlciB8IFwiICsgY2hhcmFjdGVyO1xuICAgICAgICAgICAgLy8gICB9XG4gICAgICAgICAgICAvLyB9KTtcblxuICAgICAgICAgICAgSGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5O1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh3aW5kb3cuSGlzdG9yeSwgSGlzdG9yeSwgSGlzdG9yeS5lbmFibGVkKTtcblxuICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHt9LCBudWxsLCAnL2NwL3NpdGUvZWRpaycpO1xuXG4gICAgICAgICAgICAvLyAvLyBCaW5kIHRvIFN0YXRlQ2hhbmdlIEV2ZW50XG4gICAgICAgICAgICBIaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csJ3N0YXRlY2hhbmdlJyxmdW5jdGlvbigpeyAvLyBOb3RlOiBXZSBhcmUgdXNpbmcgc3RhdGVjaGFuZ2UgaW5zdGVhZCBvZiBwb3BzdGF0ZVxuICAgICAgICAgICAgICAgIHZhciBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGUoKTsgLy8gTm90ZTogV2UgYXJlIHVzaW5nIEhpc3RvcnkuZ2V0U3RhdGUoKSBpbnN0ZWFkIG9mIGV2ZW50LnN0YXRlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gLy8gQ2hhbmdlIG91ciBTdGF0ZXNcbiAgICAgICAgICAgIEhpc3RvcnkucHVzaFN0YXRlKHtzdGF0ZToxfSwgXCJTdGF0ZSAxXCIsIFwiP3N0YXRlPTFcIik7IC8vIGxvZ3Mge3N0YXRlOjF9LCBcIlN0YXRlIDFcIiwgXCI/c3RhdGU9MVwiXG4gICAgICAgICAgICBIaXN0b3J5LnB1c2hTdGF0ZSh7c3RhdGU6Mn0sIFwiU3RhdGUgMlwiLCBcIj9zdGF0ZT0yXCIpOyAvLyBsb2dzIHtzdGF0ZToyfSwgXCJTdGF0ZSAyXCIsIFwiP3N0YXRlPTJcIlxuICAgICAgICAgICAgSGlzdG9yeS5yZXBsYWNlU3RhdGUoe3N0YXRlOjN9LCBcIlN0YXRlIDNcIiwgXCI/c3RhdGU9M1wiKTsgLy8gbG9ncyB7c3RhdGU6M30sIFwiU3RhdGUgM1wiLCBcIj9zdGF0ZT0zXCJcbiAgICAgICAgICAgIEhpc3RvcnkucHVzaFN0YXRlKG51bGwsIG51bGwsIFwiP3N0YXRlPTRcIik7IC8vIGxvZ3Mge30sICcnLCBcIj9zdGF0ZT00XCJcbiAgICAgICAgICAgIEhpc3RvcnkuYmFjaygpOyAvLyBsb2dzIHtzdGF0ZTozfSwgXCJTdGF0ZSAzXCIsIFwiP3N0YXRlPTNcIlxuICAgICAgICAgICAgSGlzdG9yeS5iYWNrKCk7IC8vIGxvZ3Mge3N0YXRlOjF9LCBcIlN0YXRlIDFcIiwgXCI/c3RhdGU9MVwiXG4gICAgICAgICAgICBIaXN0b3J5LmJhY2soKTsgLy8gbG9ncyB7fSwgXCJIb21lIFBhZ2VcIiwgXCI/XCJcbiAgICAgICAgICAgIEhpc3RvcnkuZ28oMik7IC8vIGxvZ3Mge3N0YXRlOjN9LCBcIlN0YXRlIDNcIiwgXCI/c3RhdGU9M1wiXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8qICDQmNC90LjRhtC40LDQu9C40LfQuNGA0YPQtdC8INC60L7QvdGC0LXQudC90LXRgCDQtNC70Y8g0LfQsNC/0LjRgdC10LkgKi9cbiAgICAgICAgICAgIHZhciAkZW50cmllcyA9ICQoXCIud3JhcHBlcl9fY29udGVudFwiKTtcblxuICAgICAgICAgICAgLyog0JLQtdGI0LDQtdC8INC+0LHRgNCw0LHQvtGC0YfQuNC60Lggb25saWNrINC90LAg0YHRgdGL0LvQutC4ICovXG4gICAgICAgICAgICB2YXIgJHBhZ2VfbGlua3MgPSAkKFwiLm5hdlwiKSxcbiAgICAgICAgICAgICAgICAkcHJldl9saW5rID0gJHBhZ2VfbGlua3MuZmluZChcImEubmF2X19pdGVtX19saW5rXCIpLFxuICAgICAgICAgICAgICAgICRuZXh0X2xpbmsgPSAkcGFnZV9saW5rcy5maW5kKFwiYS5uYXZfX2l0ZW1fX2xpbmtcIik7XG4gICAgICAgICAgICAkcGFnZV9saW5rcy5kZWxlZ2F0ZShcImFcIiwgXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiaHJlZlwiKTtcblxuICAgICAgICAgICAgICAgIC8qICDQo9C00LDQu9GP0LXQvCDRgtC10LrRg9GJ0LjQtSDQt9Cw0L/QuNGB0Lgg0LjQtyDQutC+0L3RgtC10LnQvdC10YDQsCAqL1xuICAgICAgICAgICAgICAgICRlbnRyaWVzLmVtcHR5KCk7XG5cbiAgICAgICAgICAgICAgICAvKiAg0J/QvtC60LDQt9GL0LLQsNC10Lwg0LjQvdC00LjQutCw0YLQvtGAINC30LDQs9GA0YPQt9C60LggKi9cbiAgICAgICAgICAgICAgICAkZW50cmllcy5hZGRDbGFzcyhcImxvYWRpbmdcIik7XG5cbiAgICAgICAgICAgICAgICAvKiAg0Jgg0YHQvtC+0LHRidCw0LXQvCBIaXN0b3J5LmpzINC+0LEg0LjQt9C80LXQvdC10L3QuNC4INGB0L7RgdGC0L7Rj9C90LjRjyDRgdGC0YDQsNC90LjRhtGLXG4gICAgICAgICAgICAgICAg0JIg0LrQsNGH0LXRgdGC0LLQtSDQv9C10YDQstC+0LPQviDQsNCz0YDRg9C80LXQvdGC0LAg0LzQvtC20L3QviDQv9C10YDQtdC00LDRgtGMINC/0YDQvtC40LfQstC+0LvRjNC90YvQuSDQvtCx0YrQtdC60YJcbiAgICAgICAgICAgICAgICDRgSDQtNC+0L/QvtC70L3QuNGC0LXQu9GM0L3Ri9C80Lgg0LTQsNC90L3Ri9C80LgsINC60L7RgtC+0YDRi9C1INC80L7QttC90L4g0LjQt9Cy0LvQtdGH0Ywg0LIg0L7QsdGA0LDQsdC+0YLRh9C40LrQtVxuICAgICAgICAgICAgICAgINC40LfQvNC10L3QtdC90LjRjyDRgdC+0YHRgtC+0Y/QvdC40Y8sINC+0L/QuNGB0LDQvdC90L7QvCDQvdC40LbQtS5cbiAgICAgICAgICAgICAgICDQkiDQvdCw0YjQtdC8INGB0LvRg9GH0LDQtSDRjdGC0L4g0LHRg9C00LXRgiDQv9GD0YHRgtC+0Lkg0L7QsdGK0LXQutGCLiAqL1xuICAgICAgICAgICAgICAgIEhpc3RvcnkucHVzaFN0YXRlKHt9LCBudWxsLCB1cmwpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8qICDQk9C+0YLQvtCy0LjQvCDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQuNC30LzQtdC90LXQvdC40Y8g0YHQvtGB0YLQvtGP0L3QuNGPINGB0YLRgNCw0L3QuNGG0YsgKi9cbiAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci5iaW5kKHdpbmRvdywgXCJzdGF0ZWNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLyogINCf0L7Qu9GD0YfQsNC10Lwg0LjQvdGE0L7RgNC80LDRhtC40Y4g0L4g0YHQvtGB0YLQvtGP0L3QuNC4INGB0YLRgNCw0L3QuNGG0YsgKi9cbiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlKCk7XG5cbiAgICAgICAgICAgICAgICAvKiDQn9C+0LvRg9GH0LDQtdC8IFVSTCDQvdC+0LLQvtCz0L4g0YHQvtGB0YLQvtGP0L3QuNGPLiDQrdGC0L4gVVJMLCDQutC+0YLQvtGA0YvQuSDQvNGLINC/0LXRgNC10LTQsNC70LhcbiAgICAgICAgICAgICAgICDQsiAucHVzaFN0YXRlKCkgKi9cbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gc3RhdGUudXJsO1xuXG4gICAgICAgICAgICAgICAgLyogINCi0YPRgiDQvNC+0LbQvdC+INC40LfQstC70LXRh9GMINC00L7Qv9C+0LvQvdC40YLQtdC70YzQvdGL0LUg0LTQsNC90L3Ri9C1LCDQviDQutC+0YLQvtGA0YvRhSDRiNC70LAg0YDQtdGH0Ywg0LLRi9GI0LUuXG4gICAgICAgICAgICAgICAg0J3QsNC/0YDQuNC80LXRgCwg0YLQsNC6OiB2YXIgZGF0YSA9IHN0YXRlLmRhdGE7ICovXG5cbiAgICAgICAgICAgICAgICAvKiAg0J7RgtC/0YDQsNCy0LvRj9C10LwgQUpBWC3Qt9Cw0L/RgNC+0YEg0L3QsCDRgdC10YDQstC10YAuXG4gICAgICAgICAgICAgICAg0JIg0LrQsNGH0LXRgdGC0LLQtSDQvtGC0LLQtdGC0LAg0LzRiyDQvtC20LjQtNCw0LXQvCBKU09OLdC+0LHRitC10LrRgiDRgdC70LXQtNGD0Y7RidC10LPQviDRhNC+0YDQvNCw0YLQsDpcbiAgICAgICAgICAgICAgICB7ZW50cmllczogXCI8YXJ0aWNsZT48aDE+Li4uPC9oMT4uLi48L2FydGljbGU+IDxhcnRpY2xlPi4uLlwiLFxuICAgICAgICAgICAgICAgICB0aXRsZTogXCLQodGC0YDQsNC90LjRhtCwIDNcIixcbiAgICAgICAgICAgICAgICAgbmV4dF91cmw6IFwiL2Jsb2cvcGFnZS80XCIsXG4gICAgICAgICAgICAgICAgIHByZXZfdXJsOiBcIi9ibG9nL3BhZ2UvMlwiIH1cbiAgICAgICAgICAgICAgICDQmtCw0LrQuNC8INC+0LHRgNCw0LfQvtC8INCx0YPQtNC10YIg0YHRhNC+0YDQvNC40YDQvtCy0LDQvSDRjdGC0L7RgiDQvtGC0LLQtdGCLCDQt9Cw0LLQuNGB0LjRgiDRgtC+0LvRjNC60L4g0L7RgiDQstCw0YEuICovXG4gICAgICAgICAgICAgICAgJC5nZXRKU09OKHVybCwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLyogINCe0LHQvdC+0LLQu9GP0LXQvCDQt9Cw0LPQvtC70L7QstC+0Log0YHRgtGA0LDQvdC40YbRiyAqL1xuICAgICAgICAgICAgICAgICAgICAkKFwidGl0bGVcIikudGV4dChyZXNwb25zZS50aXRsZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLyogINCe0LHQvdC+0LLQu9GP0LXQvCDRgdGB0YvQu9C60Lgg0L3QsCDQv9GA0LXQtNGL0LTRg9GJ0YPRjiDQuCDRgdC70LXQtNGD0Y7RidGD0Y4g0YHRgtGA0LDQvdC40YbRiyAqL1xuICAgICAgICAgICAgICAgICAgICAkcHJldl9saW5rLmF0dHIoXCJocmVmXCIsIHJlc3BvbnNlLnByZXZfdXJsKTtcbiAgICAgICAgICAgICAgICAgICAgJG5leHRfbGluay5hdHRyKFwiaHJlZlwiLCByZXNwb25zZS5uZXh0X3VybCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLyogINCYLCDQvdCw0LrQvtC90LXRhiwg0L/QvtC60LDQt9GL0LLQsNC10Lwg0L3QvtCy0YvQuSDQsdC70L7QuiDQt9Cw0L/QuNGB0LXQuSAqL1xuICAgICAgICAgICAgICAgICAgICAkZW50cmllcy5yZW1vdmVDbGFzcyhcImxvYWRpbmdcIikuaHRtbChyZXNwb25zZS5lbnRyaWVzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG59KShkb2N1bWVudC5ib2R5KTtcblxuLy8gKGZ1bmN0aW9uKHdpbmRvdyx1bmRlZmluZWQpe1xuXG4vLyAgICAgLy8gQ2hlY2sgTG9jYXRpb25cbi8vICAgICBpZiAoIGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID09PSAnZmlsZTonICkge1xuLy8gICAgICAgICBhbGVydCgnVGhlIEhUTUw1IEhpc3RvcnkgQVBJIChhbmQgdGh1cyBIaXN0b3J5LmpzKSBkbyBub3Qgd29yayBvbiBmaWxlcywgcGxlYXNlIHVwbG9hZCBpdCB0byBhIHNlcnZlci4nKTtcbi8vICAgICB9XG5cbi8vICAgICAvLyBFc3RhYmxpc2ggVmFyaWFibGVzXG4vLyAgICAgdmFyXG4vLyAgICAgICAgIEhpc3RvcnkgPSB3aW5kb3cuSGlzdG9yeSwgLy8gTm90ZTogV2UgYXJlIHVzaW5nIGEgY2FwaXRhbCBIIGluc3RlYWQgb2YgYSBsb3dlciBoXG4vLyAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5nZXRTdGF0ZSgpLFxuLy8gICAgICAgICAkbG9nID0gJCgnI2xvZycpO1xuXG4vLyAgICAgLy8gTG9nIEluaXRpYWwgU3RhdGVcbi8vICAgICBIaXN0b3J5LmxvZygnaW5pdGlhbDonLCBTdGF0ZS5kYXRhLCBTdGF0ZS50aXRsZSwgU3RhdGUudXJsKTtcblxuLy8gICAgIC8vIEJpbmQgdG8gU3RhdGUgQ2hhbmdlXG4vLyAgICAgSGlzdG9yeS5BZGFwdGVyLmJpbmQod2luZG93LCdzdGF0ZWNoYW5nZScsZnVuY3Rpb24oKXsgLy8gTm90ZTogV2UgYXJlIHVzaW5nIHN0YXRlY2hhbmdlIGluc3RlYWQgb2YgcG9wc3RhdGVcbi8vICAgICAgICAgLy8gTG9nIHRoZSBTdGF0ZVxuLy8gICAgICAgICB2YXIgU3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlKCk7IC8vIE5vdGU6IFdlIGFyZSB1c2luZyBIaXN0b3J5LmdldFN0YXRlKCkgaW5zdGVhZCBvZiBldmVudC5zdGF0ZVxuLy8gICAgICAgICBIaXN0b3J5LmxvZygnc3RhdGVjaGFuZ2U6JywgU3RhdGUuZGF0YSwgU3RhdGUudGl0bGUsIFN0YXRlLnVybCk7XG4vLyAgICAgfSk7XG5cbi8vICAgICAvLyBQcmVwYXJlIEJ1dHRvbnNcbi8vICAgICB2YXJcbi8vICAgICAgICAgYnV0dG9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25zJyksXG4vLyAgICAgICAgIHNjcmlwdHMgPSBbXG4vLyAgICAgICAgICAgICAnSGlzdG9yeS5wdXNoU3RhdGUoe3N0YXRlOjEscmFuZDpNYXRoLnJhbmRvbSgpfSwgXCJTdGF0ZSAxXCIsIFwiP3N0YXRlPTFcIik7IC8vIGxvZ3Mge3N0YXRlOjEscmFuZDpcInNvbWUgcmFuZG9tIHZhbHVlXCJ9LCBcIlN0YXRlIDFcIiwgXCI/c3RhdGU9MVwiJyxcbi8vICAgICAgICAgICAgICdIaXN0b3J5LnB1c2hTdGF0ZSh7c3RhdGU6MixyYW5kOk1hdGgucmFuZG9tKCl9LCBcIlN0YXRlIDJcIiwgXCI/c3RhdGU9MlwiKTsgLy8gbG9ncyB7c3RhdGU6MixyYW5kOlwic29tZSByYW5kb20gdmFsdWVcIn0sIFwiU3RhdGUgMlwiLCBcIj9zdGF0ZT0yXCInLFxuLy8gICAgICAgICAgICAgJ0hpc3RvcnkucmVwbGFjZVN0YXRlKHtzdGF0ZTozLHJhbmQ6TWF0aC5yYW5kb20oKX0sIFwiU3RhdGUgM1wiLCBcIj9zdGF0ZT0zXCIpOyAvLyBsb2dzIHtzdGF0ZTozLHJhbmQ6XCJzb21lIHJhbmRvbSB2YWx1ZVwifSwgXCJTdGF0ZSAzXCIsIFwiP3N0YXRlPTNcIicsXG4vLyAgICAgICAgICAgICAnSGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgbnVsbCwgXCI/c3RhdGU9NFwiKTsgLy8gbG9ncyB7fSwgXCJcIiwgXCI/c3RhdGU9NFwiJyxcbi8vICAgICAgICAgICAgICdIaXN0b3J5LmJhY2soKTsgLy8gbG9ncyB7c3RhdGU6M30sIFwiU3RhdGUgM1wiLCBcIj9zdGF0ZT0zXCInLFxuLy8gICAgICAgICAgICAgJ0hpc3RvcnkuYmFjaygpOyAvLyBsb2dzIHtzdGF0ZToxfSwgXCJTdGF0ZSAxXCIsIFwiP3N0YXRlPTFcIicsXG4vLyAgICAgICAgICAgICAnSGlzdG9yeS5iYWNrKCk7IC8vIGxvZ3Mge30sIFwiVGhlIHBhZ2UgeW91IHN0YXJ0ZWQgYXRcIiwgXCI/XCInLFxuLy8gICAgICAgICAgICAgJ0hpc3RvcnkuZ28oMik7IC8vIGxvZ3Mge3N0YXRlOjN9LCBcIlN0YXRlIDNcIiwgXCI/c3RhdGU9M1wiJ1xuLy8gICAgICAgICBdLFxuLy8gICAgICAgICBidXR0b25zSFRNTCA9ICcnXG4vLyAgICAgICAgIDtcblxuLy8gICAgIC8vIEFkZCBCdXR0b25zXG4vLyAgICAgZm9yICggdmFyIGk9MCxuPXNjcmlwdHMubGVuZ3RoOyBpPG47ICsraSApIHtcbi8vICAgICAgICAgdmFyIF9zY3JpcHQgPSBzY3JpcHRzW2ldO1xuLy8gICAgICAgICBidXR0b25zSFRNTCArPVxuLy8gICAgICAgICAgICAgJzxsaT48YnV0dG9uIG9uY2xpY2s9XFwnamF2YXNjcmlwdDonK19zY3JpcHQrJ1xcJz4nK19zY3JpcHQrJzwvYnV0dG9uPjwvbGk+Jztcbi8vICAgICB9XG4vLyAgICAgYnV0dG9ucy5pbm5lckhUTUwgPSBidXR0b25zSFRNTDtcblxuLy8gfSkod2luZG93KTsiLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICBhcHAucHJlbG9hZCA9IHtcblxuICAgICAgICBwcmVsb2FkOiBmdW5jdGlvbigkaW1hZ2UpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSAkaW1hZ2UuZGF0YSgncHJlbG9hZCcpLCBpbWFnZSA9IG51bGw7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgICAgICBpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJGltYWdlLmF0dHIoJ3NyYycsIHVybCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpbWFnZS5zcmMgPSB1cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICRpbWFnZS5hdHRyKCdzcmMnLCB1cmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAkaW1hZ2UucmVtb3ZlQXR0cignd2lkdGggaGVpZ2h0Jyk7XG4gICAgICAgICAgICAkaW1hZ2UuZGF0YSgncHJlbG9hZCcsICcnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICgkKCdpbWdbZGF0YS1wcmVsb2FkXScpLmxlbmd0aClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgJCgnaW1nW2RhdGEtcHJlbG9hZF0nKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbigkaW1hZ2Upe1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJlbG9hZCgkaW1hZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9KSgkKHRoaXMpKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9O1xuXG59KShkb2N1bWVudC5ib2R5KTsiLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICBhcHAucXVhbnRpdHkgPSB7XG5cbiAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICBlbGVtZW50OiAnLmotcXVhbnRpdHknLFxuICAgICAgICAgICAgaW5wdXQ6ICcuai1xdWFudGl0eS1jb3VudCcsXG4gICAgICAgICAgICBjb250cm9sOiAnLmotcXVhbnRpdHktY29udHJvbCcsXG4gICAgICAgICAgICBjb21wbGV0ZTogbnVsbFxuICAgICAgICB9LFxuXG4gICAgICAgIGVsZW1lbnQ6IG51bGwsXG5cbiAgICAgICAgZXh0ZW5kOiBmdW5jdGlvbihjb25maWcpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgeDtcbiAgICAgICAgICAgICAgICBmb3IgKHggaW4gY29uZmlnKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBfdGhpcy5jb25maWdbeF0gIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29uZmlnW3hdID0gY29uZmlnW3hdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24ocXVhbnRpdHkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBtaW4gPSAxLCBtYXggPSAxMDA7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnQuZGF0YSgnbWluJykpIHtcbiAgICAgICAgICAgICAgICBtaW4gPSB0aGlzLmVsZW1lbnQuZGF0YSgnbWluJyk7ICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnQuZGF0YSgnbWF4JykpIHtcbiAgICAgICAgICAgICAgICBtYXggPSB0aGlzLmVsZW1lbnQuZGF0YSgnbWF4Jyk7ICAgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChxdWFudGl0eSA+IG1heCkge1xuICAgICAgICAgICAgICAgIHF1YW50aXR5ID0gbWF4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAocXVhbnRpdHkgPCBtaW4pIHtcbiAgICAgICAgICAgICAgICBxdWFudGl0eSA9IG1pbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQodGhpcy5jb25maWcuaW5wdXQpLnZhbChxdWFudGl0eSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBpbmNyZWFzZTogZnVuY3Rpb24ocXVhbnRpdHkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHF1YW50aXR5ICs9IDE7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUocXVhbnRpdHkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlY3JlYXNlOiBmdW5jdGlvbihxdWFudGl0eSlcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKHF1YW50aXR5ID4gMSkge1xuICAgICAgICAgICAgICAgIHF1YW50aXR5IC09IDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUocXVhbnRpdHkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YodGhpcy5lbGVtZW50LmRhdGEoJ3Byb2R1Y3QnKSkgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZih0aGlzLmNvbmZpZy5jb21wbGV0ZSkgPT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5jb21wbGV0ZS5jYWxsKG51bGwsIHRoaXMuZWxlbWVudCwgdGhpcy5lbGVtZW50LmRhdGEoJ3Byb2R1Y3QnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAga2V5czogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLCByb2xlID0gJyc7XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS5vbigna2V5ZG93bicsIF90aGlzLmNvbmZpZy5pbnB1dCwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChbMzgsIDQwXS5pbmRleE9mKGUua2V5Q29kZSkgPj0gMClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgICAgICByb2xlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgMzg6ICdpbmNyZWFzZScsXG4gICAgICAgICAgICAgICAgICAgICAgICA0MDogJ2RlY3JlYXNlJ1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmVsZW1lbnQgPSAkKHRoaXMpLmNsb3Nlc3QoX3RoaXMuY29uZmlnLmVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIF90aGlzW3JvbGVbZS5rZXlDb2RlXV0ocGFyc2VJbnQoX3RoaXMuZWxlbWVudC5maW5kKF90aGlzLmNvbmZpZy5pbnB1dCkudmFsKCkpKTtcblxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jYWxsYmFjaygpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXMsIHJvbGUgPSAnJztcblxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsIF90aGlzLmNvbmZpZy5jb250cm9sLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgX3RoaXMuZWxlbWVudCA9ICQodGhpcykuY2xvc2VzdChfdGhpcy5jb25maWcuZWxlbWVudCk7XG5cbiAgICAgICAgICAgICAgICByb2xlID0gJCh0aGlzKS5kYXRhKCdyb2xlJyk7XG4gICAgICAgICBcbiAgICAgICAgICAgICAgICBpZihbJ2luY3JlYXNlJywgJ2RlY3JlYXNlJ10uaW5kZXhPZihyb2xlKSA+PSAwKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXNbcm9sZV0ocGFyc2VJbnQoX3RoaXMuZWxlbWVudC5maW5kKF90aGlzLmNvbmZpZy5pbnB1dCkudmFsKCkpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfdGhpcy5jYWxsYmFjaygpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oY29uZmlnKVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGhpcy5leHRlbmQoY29uZmlnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5iaW5kKCk7XG4gICAgICAgICAgICB0aGlzLmtleXMoKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7XG5cbi8vIHRoaXMucXVhbnRpdHkuaW5pdCh7XG4vLyAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGVsZW1lbnQsIGlkKSB7XG4vLyAgICAgICAgIC8vICQoZWxlbWVudCkuY3NzKHtcbi8vICAgICAgICAgLy8gICAgICdib3JkZXInOiAnMXB4IHNvbGlkIGxpbWUnXG4vLyAgICAgICAgIC8vIH0pO1xuXG4vLyAgICAgICAgIGNvbnNvbGUubG9nKFwiaWQgOlwiLCBpZCk7XG4vLyAgICAgfVxuLy8gfSk7XG5cbi8vIDxkaXYgY2xhc3M9XCJxdWFudGl0eSBqLXF1YW50aXR5IGNsZWFyZml4XCIgZGF0YS1wcm9kdWN0PVwiMTAwMFwiIGRhdGEtbWluPVwiMVwiIGRhdGEtbWF4PVwiOTk5XCI+XG4vLyAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJxdWFudGl0eV9fY29udHJvbCBfZGVjcmVhc2Ugai1xdWFudGl0eS1jb250cm9sXCIgZGF0YS1yb2xlPVwiZGVjcmVhc2VcIj48L2J1dHRvbj5cbi8vICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBuYW1lPVwiY291bnRbMTAwMF1cIiB2YWx1ZT1cIjFcIiBkYXRhLXJvbGU9XCJxdWFudGl0eS1pbnB1dFwiIGNsYXNzPVwicXVhbnRpdHlfX2NvdW50IGotcXVhbnRpdHktY291bnRcIiBtYXhsZW5ndGg9XCIzXCIgYXV0b2NvbXBsZXRlPVwib2ZmXCI+XG4vLyAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJxdWFudGl0eV9fY29udHJvbCBfaW5jcmVhc2Ugai1xdWFudGl0eS1jb250cm9sXCIgZGF0YS1yb2xlPVwiaW5jcmVhc2VcIj48L2J1dHRvbj5cbi8vIDwvZGl2PiIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbjsoZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgX3RoaXM7XG5cbiAgICBhcHAuc2FuZHdpY2ggPSB7XG5cbiAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICBrZXlIb29rczogITEsXG4gICAgICAgICAgICBzZWxlY3RvcjogJy5qcy1zYW5kd2ljaC1tZW51JyxcbiAgICAgICAgICAgIHdyYXBwZXI6ICcubGF5b3V0LXdyYXBwZXInLFxuICAgICAgICAgICAgb3ZlcmxheTogJy5vdmVybGF5J1xuICAgICAgICB9LFxuXG4gICAgICAgIGV4dGVuZDogZnVuY3Rpb24oY29uZmlnKVxuICAgICAgICB7XG4gICAgICAgICAgICBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgeDtcbiAgICAgICAgICAgICAgICBmb3IgKHggaW4gY29uZmlnKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBfdGhpcy5jb25maWdbeF0gIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29uZmlnW3hdID0gY29uZmlnW3hdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpc09wZW46IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgcmV0dXJuICQoJ2JvZHknKS5oYXNDbGFzcygncGFnZS12aXNpYmxlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZTogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3BhZ2Utb3BlbicpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdwYWdlLXZpc2libGUnKTtcbiAgICAgICAgICAgIH0sIDEwKTtcblxuICAgICAgICAgICAgJCh0aGlzLmNvbmZpZy5vdmVybGF5KS5jc3Moe1xuICAgICAgICAgICAgICAgICd2aXNpYmlsaXR5JzogJ2hpZGRlbidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdwYWdlLXZpc2libGUnKSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3BhZ2Utb3BlbicpO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3BhZ2UtdmlzaWJsZScpO1xuICAgICAgICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdwYWdlLW9wZW4nKTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdwYWdlLXZpc2libGUnKTtcbiAgICAgICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB2aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xuXG4gICAgICAgICAgICBpZiAoISQoJ2JvZHknKS5oYXNDbGFzcygncGFnZS1vcGVuJykpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eSA9ICdoaWRkZW4nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQoX3RoaXMuY29uZmlnLm92ZXJsYXkpLmNzcyh7XG4gICAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknOiB2aXNpYmlsaXR5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzYW5kd2ljaFRyaWdnZXI6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAoX3RoaXMuY29uZmlnLmtleUhvb2tzKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZS5rZXlDb2RlID09IDI3ICYmIF90aGlzLmlzT3BlbigpKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsIF90aGlzLmNvbmZpZy5zZWxlY3RvciwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCA/IGUucHJldmVudERlZmF1bHQoKSA6IGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBfdGhpcy50b2dnbGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG92ZXJsYXlUcmlnZ2VyOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsIF90aGlzLmNvbmZpZy5vdmVybGF5LCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbihjb25maWcpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kKGNvbmZpZyk7XG4gICAgICAgICAgICB0aGlzLnNhbmR3aWNoVHJpZ2dlcigpO1xuICAgICAgICAgICAgdGhpcy5vdmVybGF5VHJpZ2dlcigpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG59KShkb2N1bWVudC5ib2R5KTsiLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICBhcHAudGFicyA9IHtcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkd3JhcHBlciA9IG51bGwsIHRhYiA9ICcnO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy5qLXRhYi10cmlnZ2VyJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdfb3BlbicpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYiA9ICQodGhpcykuZGF0YSgndGFiJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHdyYXBwZXIgPSAkKHRoaXMpLmNsb3Nlc3QoJy5qLXRhYi13cmFwcGVyJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHdyYXBwZXIuZmluZCgnLmotdGFiLXRyaWdnZXInKS5yZW1vdmVDbGFzcygnX2N1cnJlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgJHdyYXBwZXIuZmluZCgnLmotdGFiLWl0ZW0nKS5yZW1vdmVDbGFzcygnX29wZW4nKTtcblxuICAgICAgICAgICAgICAgICAgICAkd3JhcHBlci5maW5kKCcjdGFiLScrdGFiKS5hZGRDbGFzcygnX29wZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnX2N1cnJlbnQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLnRvZ2dsZSA9IHtcbiAgICAgICAgXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgJHRvZ2dsZSA9IG51bGwsIHRleHQgPSAnJywgaGlkZSA9IHRydWUsIHJlbW92ZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy5qLXRvZ2dsZS10cmlnZ2VyJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgJHRvZ2dsZSA9ICQodGhpcykuY2xvc2VzdCgnLmotdG9nZ2xlJykuZmluZCgnLmotdG9nZ2xlLWl0ZW0nKTtcblxuICAgICAgICAgICAgICAgIGlmICgkdG9nZ2xlKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJHRvZ2dsZS50b2dnbGVDbGFzcygnaXMtc2hvdycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgkdG9nZ2xlLmhhc0NsYXNzKCdpcy1oaWRkZW4nKSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICR0b2dnbGUucmVtb3ZlQ2xhc3MoJ2lzLWhpZGRlbicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmRhdGEoJ3RvZ2dsZS10ZXh0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuZGF0YSgndG9nZ2xlLXRleHQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKCQodGhpcykuZGF0YSgncmVtb3ZlJykpICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmUgPSAkKHRoaXMpLmRhdGEoJ3JlbW92ZScpID09ICcwJyA/IGZhbHNlIDogKCQodGhpcykuZGF0YSgncmVtb3ZlJykgPT0gJzEnID8gdHJ1ZSA6IGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGhpZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChyZW1vdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ3RvZ2dsZS10ZXh0JywgJCh0aGlzKS5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmh0bWwodGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG59KShkb2N1bWVudC5ib2R5KTtcblxuLy8gPGRpdiBjbGFzcz1cImotdG9nZ2xlXCI+XG4vLyAgICAgPGRpdiBjbGFzcz1cImotdG9nZ2xlLWl0ZW1cIj4gY29udGVudCA8L2Rpdj5cbi8vICAgICA8c3BhbiBjbGFzcz1cImotdG9nZ2xlLXRyaWdnZXJcIiBkYXRhLXRvZ2dsZS10ZXh0PVwi0KHQutGA0YvRgtGMLi4uXCIgZGF0YS1oaWRlPVwiMVwiIGRhdGEtcmVtb3ZlPVwiMVwiPtCV0YnQtS4uLjwvc3Bhbj5cbi8vIDwvZGl2PiIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBfXygpIHt0cnkge2Zvcih2YXIgaT0wOyBpPGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge2NvbnNvbGUubG9nKGFyZ3VtZW50c1tpXSk7fX1jYXRjaCAoZSkge319XG5cbmZ1bmN0aW9uIHNwcmludGYodikge1xuICB2YXIgc3BsaXQgPSB2LnRvU3RyaW5nKCkuc3BsaXQoJy4nKSwgcGFkID0gXCIwMFwiLCB0aW1lID0gW10sIHggPSBudWxsO1xuXG4gIGZvciAoeCBpbiBzcGxpdCkge1xuICAgIHRpbWUucHVzaChwYWQuc3Vic3RyaW5nKDAsIDIgLSBzcGxpdFt4XS50b1N0cmluZygpLmxlbmd0aCkgKyBzcGxpdFt4XSk7XG4gIH1cblxuICByZXR1cm4gdGltZS5qb2luKCcuJyk7XG59IiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgYXBwLmluaXQoKTtcbn0pOyJdfQ==
