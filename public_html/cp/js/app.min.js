var app = app || {};

(function(body){
    "use strict";

    app = {
        
        init: function()
        {
            // this.history.init();
            
            // var container = document.querySelector('.gallery');

            // container.addEventListener('click', function(e) {
            //   if (e.target != e.currentTarget) {
            //     e.preventDefault();
            //     // e.target is the image inside the link we just clicked.
            //   }
            //   e.stopPropagation();
            // }, false);

            // window.addEventListener('popstate', function(e) {
            //   // e.state is equal to the data-attribute of the last image we clicked
            // });
        }

    };

})(document.body);

// cookie.set({
//    key1: 'value1',
//    key2: 'value2'
// });

// cookie.set('key', 'value', {
//    expires: 7, // expires in one week
// });

// cookie.set({
//    key1: 'value1',
//    key2: 'value2'
// }, {
//    expires: 7
// })

// cookie.defaults.expires = 7;
// cookie.defaults.secure = true;


// cookie.expiresMultiplier = 60; // Seconds.
// cookie.expiresMultiplier = 60 * 60; // Minutes.
// cookie.expiresMultiplier = 60 * 60 * 24; // Hours.


// cookie.get('key');

// cookie.get(['key1', 'key2']);

// cookie.get('key', 'default value');
// cookie.get(['key1', 'key2'], 'default value');


// cookie.get('key');
// // is the same as
// cookie('key');

// var cookies = cookie.all();

// cookie.remove('key');
// cookie.remove('key1', 'key2');
// cookie.remove(['key1', 'key2']);

// if (cookie.enabled()) {
//    // Do stuff with cookies
// } else {
//    // Display error message or use localStorage
// }


// cookie.set('a', '1');
// cookie.setDefault({
//    a: '2',
//    b: '2'
// });

// cookie.get(['a', 'b']); // {a: "1", b: "2"}

// cookie.set('a', 'b', { path: '/somepath' });

// // This won't work
// cookie.remove('a');

// // You have to do this
// cookie.removeSpecific('a', { path: '/somepath' });

// // You can also give an array of cookie keys
// cookie.removeSpecific(['a', 'b'], { path: '/somepath' });

// cookie.empty().set('key1', 'value1').set('key2', 'value2').remove('key1');

// cookie.utils.decode = function (value) {
//    return decodeURIComponent(value).replace('+', ' ');
// };

var app = app || {};

(function(body){
    "use strict";

    // // Prepare
    // var History = window.History; // Note: We are using a capital H instead of a lower h
    // if ( !History.enabled ) {
    //      // History.js is disabled for this browser.
    //      // This is because we can optionally choose to support HTML4 browsers or not.
    //     return false;
    // }

    // // Bind to StateChange Event
    // History.Adapter.bind(window,'statechange',function() { // Note: We are using statechange instead of popstate
    //     var State = History.getState();
    //     $('#content').load(State.url);
    //     /* Instead of the line above, you could run the code below if the url returns the whole page instead of just the content (assuming it has a `#content`): */
    //     $.get(State.url, function(response) {
    //         $('#content').html($(response).find('#content').html()); });
    //     });


    // // Capture all the links to push their url to the history stack and trigger the StateChange Event
    // $('a').click(function(evt) {
    //     evt.preventDefault();
    //     History.pushState(null, $(this).text(), $(this).attr('href'));
    // });

    app.history = {
        
        navi: null,

        wrap: null,

        init: function()
        {
            var _this_ = this, _url_ = null;

            _this_.navi = $(".j-ajax-link");
            _this_.wrap = $("#content");

            _this_.navi.on('click', function(e){
                e.preventDefault();
                
                _url_ = $(this).attr('href');
                
                _this_.navi.filter('.is-current').removeClass('is-current');
                _this_.navi.filter('[href="'+_url_+'"]').addClass('is-current');

                window.history.pushState({}, null, _url_);
            });

            console.log(window.History);

            // function requestContent(file) {
            //   $('.wrapper__content').load(file + ' .wrapper__content');
            // }

            // window.addEventListener('popstate', function(e) {
            //   var character = e.state;

            //   if (character == null) {
            //     removeCurrentClass();
            //     textWrapper.innerHTML = " ";
            //     content.innerHTML = " ";
            //     document.title = defaultTitle;
            //   } else {
            //       updateText(character);
            //       requestContent(character + ".html");
            //       addCurrentClass(character);
            //       document.title = "Ghostbuster | " + character;
            //   }
            // });

            // 

            // Bind to StateChange Event
            // History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
            //     var State = History.getState(); // Note: We are using History.getState() instead of event.state
            // });

            // // // Change our States
            // History.pushState({state:1}, "State 1", "?state=1"); // logs {state:1}, "State 1", "?state=1"
            // History.pushState({state:2}, "State 2", "?state=2"); // logs {state:2}, "State 2", "?state=2"
            // History.replaceState({state:3}, "State 3", "?state=3"); // logs {state:3}, "State 3", "?state=3"
            // History.pushState(null, null, "?state=4"); // logs {}, '', "?state=4"
            // History.back(); // logs {state:3}, "State 3", "?state=3"
            // History.back(); // logs {state:1}, "State 1", "?state=1"
            // History.back(); // logs {}, "Home Page", "?"
            // History.go(2); // logs {state:3}, "State 3", "?state=3"
            
            return false;

            /*  Инициализируем контейнер для записей */
            var $entries = $(".wrapper__content");

            /* Вешаем обработчики onlick на ссылки */
            var $page_links = $(".nav"),
                $prev_link = $page_links.find("a.nav__item__link"),
                $next_link = $page_links.find("a.nav__item__link");
            $page_links.delegate("a", "click", function (e) {
                e.preventDefault();
                var url = $(this).attr("href");

                /*  Удаляем текущие записи из контейнера */
                $entries.empty();

                /*  Показываем индикатор загрузки */
                $entries.addClass("loading");

                /*  И сообщаем History.js об изменении состояния страницы
                В качестве первого агрумента можно передать произвольный объект
                с дополнительными данными, которые можно извлечь в обработчике
                изменения состояния, описанном ниже.
                В нашем случае это будет пустой объект. */
                window.history.pushState({}, null, url);
            });

            /*  Готовим обработчик изменения состояния страницы */
            window.history.Adapter.bind(window, "statechange", function () {
                /*  Получаем информацию о состоянии страницы */
                var state = window.history.getState();

                /* Получаем URL нового состояния. Это URL, который мы передали
                в .pushState() */
                var url = state.url;

                /*  Тут можно извлечь дополнительные данные, о которых шла речь выше.
                Например, так: var data = state.data; */

                /*  Отправляем AJAX-запрос на сервер.
                В качестве ответа мы ожидаем JSON-объект следующего формата:
                {entries: "<article><h1>...</h1>...</article> <article>...",
                 title: "Страница 3",
                 next_url: "/blog/page/4",
                 prev_url: "/blog/page/2" }
                Каким образом будет сформирован этот ответ, зависит только от вас. */
                $.getJSON(url, function (response) {

                    /*  Обновляем заголовок страницы */
                    $("title").text(response.title);

                    /*  Обновляем ссылки на предыдущую и следующую страницы */
                    $prev_link.attr("href", response.prev_url);
                    $next_link.attr("href", response.next_url);

                    /*  И, наконец, показываем новый блок записей */
                    $entries.removeClass("loading").html(response.entries);
                });
            });
        }

    };

})(document.body);

// (function(window,undefined){

//     // Check Location
//     if ( document.location.protocol === 'file:' ) {
//         alert('The HTML5 History API (and thus History.js) do not work on files, please upload it to a server.');
//     }

//     // Establish Variables
//     var
//         History = window.History, // Note: We are using a capital H instead of a lower h
//         State = History.getState(),
//         $log = $('#log');

//     // Log Initial State
//     History.log('initial:', State.data, State.title, State.url);

//     // Bind to State Change
//     History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
//         // Log the State
//         var State = History.getState(); // Note: We are using History.getState() instead of event.state
//         History.log('statechange:', State.data, State.title, State.url);
//     });

//     // Prepare Buttons
//     var
//         buttons = document.getElementById('buttons'),
//         scripts = [
//             'History.pushState({state:1,rand:Math.random()}, "State 1", "?state=1"); // logs {state:1,rand:"some random value"}, "State 1", "?state=1"',
//             'History.pushState({state:2,rand:Math.random()}, "State 2", "?state=2"); // logs {state:2,rand:"some random value"}, "State 2", "?state=2"',
//             'History.replaceState({state:3,rand:Math.random()}, "State 3", "?state=3"); // logs {state:3,rand:"some random value"}, "State 3", "?state=3"',
//             'History.pushState(null, null, "?state=4"); // logs {}, "", "?state=4"',
//             'History.back(); // logs {state:3}, "State 3", "?state=3"',
//             'History.back(); // logs {state:1}, "State 1", "?state=1"',
//             'History.back(); // logs {}, "The page you started at", "?"',
//             'History.go(2); // logs {state:3}, "State 3", "?state=3"'
//         ],
//         buttonsHTML = ''
//         ;

//     // Add Buttons
//     for ( var i=0,n=scripts.length; i<n; ++i ) {
//         var _script = scripts[i];
//         buttonsHTML +=
//             '<li><button onclick=\'javascript:'+_script+'\'>'+_script+'</button></li>';
//     }
//     buttons.innerHTML = buttonsHTML;

// })(window);
var app = app || {};

(function(body){
    "use strict";

    app.preload = {

        preload: function($image)
        {
            var url = $image.data('preload'), image = null;

            try {
                image = new Image();
                image.onload = function() {
                    $image.attr('src', url);
                };
                image.src = url;
            }
            catch (e) {
                $image.attr('src', url);
            }
            
            $image.removeAttr('width height');
            $image.data('preload', '');
        },

        init: function()
        {
            if ($('img[data-preload]').length)
            {
                var _this = this;
            
                $('img[data-preload]').each(function(){
                    (function($image){
                        _this.preload($image);
                    })($(this))
                });
            }
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.quantity = {

        config: {
            element: '.j-quantity',
            input: '.j-quantity-count',
            control: '.j-quantity-control',
            complete: null
        },

        element: null,

        extend: function(config)
        {
            var _this = this;

            if (typeof config !== 'undefined')
            {
                var x;
                for (x in config)
                {
                    if (typeof _this.config[x] !== 'undefined')
                        _this.config[x] = config[x];
                }
            }
        },

        setValue: function(quantity)
        {
            var min = 1, max = 100;

            if (this.element.data('min')) {
                min = this.element.data('min');   
            }
            
            if (this.element.data('max')) {
                max = this.element.data('max');   
            }

            if (quantity > max) {
                quantity = max;
            }
            
            if (quantity < min) {
                quantity = min;
            }

            this.element.find(this.config.input).val(quantity);

        },

        increase: function(quantity)
        {
            quantity += 1;

            this.setValue(quantity);
        },

        decrease: function(quantity)
        {
            if (quantity > 1) {
                quantity -= 1;
            }

            this.setValue(quantity);
        },

        callback: function()
        {
            if (typeof(this.element.data('product')) !== 'undefined' && typeof(this.config.complete) == 'function')
            {
                this.config.complete.call(null, this.element, this.element.data('product'));
            }
        },

        keys: function()
        {
            var _this = this, role = '';

            $('body').on('keydown', _this.config.input, function(e) {
                if ([38, 40].indexOf(e.keyCode) >= 0)
                {
                    e.preventDefault();

                    role = {
                        38: 'increase',
                        40: 'decrease'
                    };

                    _this.element = $(this).closest(_this.config.element);

                    _this[role[e.keyCode]](parseInt(_this.element.find(_this.config.input).val()));

                    _this.callback();

                    return false;
                }
            });
        },

        bind: function()
        {
            var _this = this, role = '';

            $('body').on('click', _this.config.control, function(e) {
                e.preventDefault();

                _this.element = $(this).closest(_this.config.element);

                role = $(this).data('role');
         
                if(['increase', 'decrease'].indexOf(role) >= 0)
                {
                    _this[role](parseInt(_this.element.find(_this.config.input).val()));
                }

                _this.callback();

                return !1;
            });
        },

        init: function(config)
        {
            if (typeof config !== 'undefined')
            {
                this.extend(config);
            }

            this.bind();
            this.keys();
        }

    };

})(document.body);

// this.quantity.init({
//     complete: function(element, id) {
//         // $(element).css({
//         //     'border': '1px solid lime'
//         // });

//         console.log("id :", id);
//     }
// });

// <div class="quantity j-quantity clearfix" data-product="1000" data-min="1" data-max="999">
//     <button type="button" class="quantity__control _decrease j-quantity-control" data-role="decrease"></button>
//     <input type="text" name="count[1000]" value="1" data-role="quantity-input" class="quantity__count j-quantity-count" maxlength="3" autocomplete="off">
//     <button type="button" class="quantity__control _increase j-quantity-control" data-role="increase"></button>
// </div>
var app = app || {};

;(function(body){
    "use strict";

    var _this;

    app.sandwich = {

        config: {
            keyHooks: !1,
            selector: '.js-sandwich-menu',
            wrapper: '.layout-wrapper',
            overlay: '.overlay'
        },

        extend: function(config)
        {
            _this = this;

            if (typeof config !== 'undefined')
            {
                var x;
                for (x in config)
                {
                    if (typeof _this.config[x] !== 'undefined')
                        _this.config[x] = config[x];
                }
            }
        },

        isOpen: function()
        {
            return $('body').hasClass('page-visible');
        },

        hide: function()
        {
            $('body').removeClass('page-open');

            setTimeout(function(){
                $('body').removeClass('page-visible');
            }, 10);

            $(this.config.overlay).css({
                'visibility': 'hidden'
            });
        },

        toggle: function()
        {
            if ($('body').hasClass('page-visible'))
            {
                $('body').removeClass('page-open');

                setTimeout(function(){
                    $('body').removeClass('page-visible');
                }, 200);
            }
            else
            {
                $('body').addClass('page-open');

                setTimeout(function(){
                    $('body').addClass('page-visible');
                }, 10);
            }

            var visibility = 'visible';

            if (!$('body').hasClass('page-open'))
            {
                visibility = 'hidden'
            }
            
            $(_this.config.overlay).css({
                'visibility': visibility
            });
        },

        sandwichTrigger: function()
        {
            _this = this;

            if (_this.config.keyHooks)
            {
                $('body').on('keydown', function(e) {
                    if(e.keyCode == 27 && _this.isOpen())
                    {
                        _this.toggle();
                    }
                });
            };

            $('body').on('click', _this.config.selector, function(e){
                e.preventDefault ? e.preventDefault() : e.returnValue = false;
                _this.toggle();
            });
        },

        overlayTrigger: function()
        {
            _this = this;

            $('body').on('click', _this.config.overlay, function(e){
                _this.hide();
            });
        },

        init: function(config)
        {
            this.extend(config);
            this.sandwichTrigger();
            this.overlayTrigger();
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.tabs = {

        init: function() {
            var $wrapper = null, tab = '';

            $('body').on('click', '.j-tab-trigger', function(e){
                e.preventDefault();

                if (!$(this).hasClass('_open')) {
                    tab = $(this).data('tab');

                    $wrapper = $(this).closest('.j-tab-wrapper');

                    $wrapper.find('.j-tab-trigger').removeClass('_current');
                    $wrapper.find('.j-tab-item').removeClass('_open');

                    $wrapper.find('#tab-'+tab).addClass('_open');
                    $(this).addClass('_current');
                }

                return !1;
            });
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.toggle = {
        
        init: function() {
            
            var $toggle = null, text = '', hide = true, remove = false;

            $('body').on('click', '.j-toggle-trigger', function(e){
                e.preventDefault();

                $toggle = $(this).closest('.j-toggle').find('.j-toggle-item');

                if ($toggle)
                {
                    $toggle.toggleClass('is-show');
                }

                if ($toggle.hasClass('is-hidden'))
                {
                    $toggle.removeClass('is-hidden');
                }

                if ($(this).data('toggle-text')) {
                    text = $(this).data('toggle-text');
                }

                if (typeof($(this).data('remove')) !== 'undefined') {
                    remove = $(this).data('remove') == '0' ? false : ($(this).data('remove') == '1' ? true : false);
                }
                
                if (hide) {
                    $(this).hide();
                }
                
                if (remove) {
                    $(this).remove();
                }

                if (text) {
                    $(this).data('toggle-text', $(this).html());
                    $(this).html(text);
                }

                return false;
            })

        }

    };

})(document.body);

// <div class="j-toggle">
//     <div class="j-toggle-item"> content </div>
//     <span class="j-toggle-trigger" data-toggle-text="Скрыть..." data-hide="1" data-remove="1">Еще...</span>
// </div>
"use strict";

function __() {try {for(var i=0; i<arguments.length; i++) {console.log(arguments[i]);}}catch (e) {}}

function sprintf(v) {
  var split = v.toString().split('.'), pad = "00", time = [], x = null;

  for (x in split) {
    time.push(pad.substring(0, 2 - split[x].toString().length) + split[x]);
  }

  return time.join('.');
}
$(document).ready(function() {
    app.init();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9fYXBwLmpzIiwiX2FwcC5oaXN0b3J5LmpzIiwiX2FwcC5wcmVsb2FkLmpzIiwiX2FwcC5xdWFudGl0eS5qcyIsIl9hcHAuc2FuZHdpY2guanMiLCJfYXBwLnRhYnMuanMiLCJfYXBwLnRvZ2dsZS5qcyIsIl9mdW5jdGlvbnMuanMiLCJpbml0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwID0ge1xuICAgICAgICBcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyB0aGlzLmhpc3RvcnkuaW5pdCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbGxlcnknKTtcblxuICAgICAgICAgICAgLy8gY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgLy8gICBpZiAoZS50YXJnZXQgIT0gZS5jdXJyZW50VGFyZ2V0KSB7XG4gICAgICAgICAgICAvLyAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgLy8gICAgIC8vIGUudGFyZ2V0IGlzIHRoZSBpbWFnZSBpbnNpZGUgdGhlIGxpbmsgd2UganVzdCBjbGlja2VkLlxuICAgICAgICAgICAgLy8gICB9XG4gICAgICAgICAgICAvLyAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAvLyB9LCBmYWxzZSk7XG5cbiAgICAgICAgICAgIC8vIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIC8vICAgLy8gZS5zdGF0ZSBpcyBlcXVhbCB0byB0aGUgZGF0YS1hdHRyaWJ1dGUgb2YgdGhlIGxhc3QgaW1hZ2Ugd2UgY2xpY2tlZFxuICAgICAgICAgICAgLy8gfSk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpO1xuXG4vLyBjb29raWUuc2V0KHtcbi8vICAgIGtleTE6ICd2YWx1ZTEnLFxuLy8gICAga2V5MjogJ3ZhbHVlMidcbi8vIH0pO1xuXG4vLyBjb29raWUuc2V0KCdrZXknLCAndmFsdWUnLCB7XG4vLyAgICBleHBpcmVzOiA3LCAvLyBleHBpcmVzIGluIG9uZSB3ZWVrXG4vLyB9KTtcblxuLy8gY29va2llLnNldCh7XG4vLyAgICBrZXkxOiAndmFsdWUxJyxcbi8vICAgIGtleTI6ICd2YWx1ZTInXG4vLyB9LCB7XG4vLyAgICBleHBpcmVzOiA3XG4vLyB9KVxuXG4vLyBjb29raWUuZGVmYXVsdHMuZXhwaXJlcyA9IDc7XG4vLyBjb29raWUuZGVmYXVsdHMuc2VjdXJlID0gdHJ1ZTtcblxuXG4vLyBjb29raWUuZXhwaXJlc011bHRpcGxpZXIgPSA2MDsgLy8gU2Vjb25kcy5cbi8vIGNvb2tpZS5leHBpcmVzTXVsdGlwbGllciA9IDYwICogNjA7IC8vIE1pbnV0ZXMuXG4vLyBjb29raWUuZXhwaXJlc011bHRpcGxpZXIgPSA2MCAqIDYwICogMjQ7IC8vIEhvdXJzLlxuXG5cbi8vIGNvb2tpZS5nZXQoJ2tleScpO1xuXG4vLyBjb29raWUuZ2V0KFsna2V5MScsICdrZXkyJ10pO1xuXG4vLyBjb29raWUuZ2V0KCdrZXknLCAnZGVmYXVsdCB2YWx1ZScpO1xuLy8gY29va2llLmdldChbJ2tleTEnLCAna2V5MiddLCAnZGVmYXVsdCB2YWx1ZScpO1xuXG5cbi8vIGNvb2tpZS5nZXQoJ2tleScpO1xuLy8gLy8gaXMgdGhlIHNhbWUgYXNcbi8vIGNvb2tpZSgna2V5Jyk7XG5cbi8vIHZhciBjb29raWVzID0gY29va2llLmFsbCgpO1xuXG4vLyBjb29raWUucmVtb3ZlKCdrZXknKTtcbi8vIGNvb2tpZS5yZW1vdmUoJ2tleTEnLCAna2V5MicpO1xuLy8gY29va2llLnJlbW92ZShbJ2tleTEnLCAna2V5MiddKTtcblxuLy8gaWYgKGNvb2tpZS5lbmFibGVkKCkpIHtcbi8vICAgIC8vIERvIHN0dWZmIHdpdGggY29va2llc1xuLy8gfSBlbHNlIHtcbi8vICAgIC8vIERpc3BsYXkgZXJyb3IgbWVzc2FnZSBvciB1c2UgbG9jYWxTdG9yYWdlXG4vLyB9XG5cblxuLy8gY29va2llLnNldCgnYScsICcxJyk7XG4vLyBjb29raWUuc2V0RGVmYXVsdCh7XG4vLyAgICBhOiAnMicsXG4vLyAgICBiOiAnMidcbi8vIH0pO1xuXG4vLyBjb29raWUuZ2V0KFsnYScsICdiJ10pOyAvLyB7YTogXCIxXCIsIGI6IFwiMlwifVxuXG4vLyBjb29raWUuc2V0KCdhJywgJ2InLCB7IHBhdGg6ICcvc29tZXBhdGgnIH0pO1xuXG4vLyAvLyBUaGlzIHdvbid0IHdvcmtcbi8vIGNvb2tpZS5yZW1vdmUoJ2EnKTtcblxuLy8gLy8gWW91IGhhdmUgdG8gZG8gdGhpc1xuLy8gY29va2llLnJlbW92ZVNwZWNpZmljKCdhJywgeyBwYXRoOiAnL3NvbWVwYXRoJyB9KTtcblxuLy8gLy8gWW91IGNhbiBhbHNvIGdpdmUgYW4gYXJyYXkgb2YgY29va2llIGtleXNcbi8vIGNvb2tpZS5yZW1vdmVTcGVjaWZpYyhbJ2EnLCAnYiddLCB7IHBhdGg6ICcvc29tZXBhdGgnIH0pO1xuXG4vLyBjb29raWUuZW1wdHkoKS5zZXQoJ2tleTEnLCAndmFsdWUxJykuc2V0KCdrZXkyJywgJ3ZhbHVlMicpLnJlbW92ZSgna2V5MScpO1xuXG4vLyBjb29raWUudXRpbHMuZGVjb2RlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4vLyAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKS5yZXBsYWNlKCcrJywgJyAnKTtcbi8vIH07XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLyAvLyBQcmVwYXJlXG4gICAgLy8gdmFyIEhpc3RvcnkgPSB3aW5kb3cuSGlzdG9yeTsgLy8gTm90ZTogV2UgYXJlIHVzaW5nIGEgY2FwaXRhbCBIIGluc3RlYWQgb2YgYSBsb3dlciBoXG4gICAgLy8gaWYgKCAhSGlzdG9yeS5lbmFibGVkICkge1xuICAgIC8vICAgICAgLy8gSGlzdG9yeS5qcyBpcyBkaXNhYmxlZCBmb3IgdGhpcyBicm93c2VyLlxuICAgIC8vICAgICAgLy8gVGhpcyBpcyBiZWNhdXNlIHdlIGNhbiBvcHRpb25hbGx5IGNob29zZSB0byBzdXBwb3J0IEhUTUw0IGJyb3dzZXJzIG9yIG5vdC5cbiAgICAvLyAgICAgcmV0dXJuIGZhbHNlO1xuICAgIC8vIH1cblxuICAgIC8vIC8vIEJpbmQgdG8gU3RhdGVDaGFuZ2UgRXZlbnRcbiAgICAvLyBIaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csJ3N0YXRlY2hhbmdlJyxmdW5jdGlvbigpIHsgLy8gTm90ZTogV2UgYXJlIHVzaW5nIHN0YXRlY2hhbmdlIGluc3RlYWQgb2YgcG9wc3RhdGVcbiAgICAvLyAgICAgdmFyIFN0YXRlID0gSGlzdG9yeS5nZXRTdGF0ZSgpO1xuICAgIC8vICAgICAkKCcjY29udGVudCcpLmxvYWQoU3RhdGUudXJsKTtcbiAgICAvLyAgICAgLyogSW5zdGVhZCBvZiB0aGUgbGluZSBhYm92ZSwgeW91IGNvdWxkIHJ1biB0aGUgY29kZSBiZWxvdyBpZiB0aGUgdXJsIHJldHVybnMgdGhlIHdob2xlIHBhZ2UgaW5zdGVhZCBvZiBqdXN0IHRoZSBjb250ZW50IChhc3N1bWluZyBpdCBoYXMgYSBgI2NvbnRlbnRgKTogKi9cbiAgICAvLyAgICAgJC5nZXQoU3RhdGUudXJsLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgIC8vICAgICAgICAgJCgnI2NvbnRlbnQnKS5odG1sKCQocmVzcG9uc2UpLmZpbmQoJyNjb250ZW50JykuaHRtbCgpKTsgfSk7XG4gICAgLy8gICAgIH0pO1xuXG5cbiAgICAvLyAvLyBDYXB0dXJlIGFsbCB0aGUgbGlua3MgdG8gcHVzaCB0aGVpciB1cmwgdG8gdGhlIGhpc3Rvcnkgc3RhY2sgYW5kIHRyaWdnZXIgdGhlIFN0YXRlQ2hhbmdlIEV2ZW50XG4gICAgLy8gJCgnYScpLmNsaWNrKGZ1bmN0aW9uKGV2dCkge1xuICAgIC8vICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAvLyAgICAgSGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgJCh0aGlzKS50ZXh0KCksICQodGhpcykuYXR0cignaHJlZicpKTtcbiAgICAvLyB9KTtcblxuICAgIGFwcC5oaXN0b3J5ID0ge1xuICAgICAgICBcbiAgICAgICAgbmF2aTogbnVsbCxcblxuICAgICAgICB3cmFwOiBudWxsLFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIF90aGlzXyA9IHRoaXMsIF91cmxfID0gbnVsbDtcblxuICAgICAgICAgICAgX3RoaXNfLm5hdmkgPSAkKFwiLmotYWpheC1saW5rXCIpO1xuICAgICAgICAgICAgX3RoaXNfLndyYXAgPSAkKFwiI2NvbnRlbnRcIik7XG5cbiAgICAgICAgICAgIF90aGlzXy5uYXZpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBfdXJsXyA9ICQodGhpcykuYXR0cignaHJlZicpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIF90aGlzXy5uYXZpLmZpbHRlcignLmlzLWN1cnJlbnQnKS5yZW1vdmVDbGFzcygnaXMtY3VycmVudCcpO1xuICAgICAgICAgICAgICAgIF90aGlzXy5uYXZpLmZpbHRlcignW2hyZWY9XCInK191cmxfKydcIl0nKS5hZGRDbGFzcygnaXMtY3VycmVudCcpO1xuXG4gICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHt9LCBudWxsLCBfdXJsXyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2cod2luZG93Lkhpc3RvcnkpO1xuXG4gICAgICAgICAgICAvLyBmdW5jdGlvbiByZXF1ZXN0Q29udGVudChmaWxlKSB7XG4gICAgICAgICAgICAvLyAgICQoJy53cmFwcGVyX19jb250ZW50JykubG9hZChmaWxlICsgJyAud3JhcHBlcl9fY29udGVudCcpO1xuICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICAvLyB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAvLyAgIHZhciBjaGFyYWN0ZXIgPSBlLnN0YXRlO1xuXG4gICAgICAgICAgICAvLyAgIGlmIChjaGFyYWN0ZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gICAgIHJlbW92ZUN1cnJlbnRDbGFzcygpO1xuICAgICAgICAgICAgLy8gICAgIHRleHRXcmFwcGVyLmlubmVySFRNTCA9IFwiIFwiO1xuICAgICAgICAgICAgLy8gICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gXCIgXCI7XG4gICAgICAgICAgICAvLyAgICAgZG9jdW1lbnQudGl0bGUgPSBkZWZhdWx0VGl0bGU7XG4gICAgICAgICAgICAvLyAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAgICAgICB1cGRhdGVUZXh0KGNoYXJhY3Rlcik7XG4gICAgICAgICAgICAvLyAgICAgICByZXF1ZXN0Q29udGVudChjaGFyYWN0ZXIgKyBcIi5odG1sXCIpO1xuICAgICAgICAgICAgLy8gICAgICAgYWRkQ3VycmVudENsYXNzKGNoYXJhY3Rlcik7XG4gICAgICAgICAgICAvLyAgICAgICBkb2N1bWVudC50aXRsZSA9IFwiR2hvc3RidXN0ZXIgfCBcIiArIGNoYXJhY3RlcjtcbiAgICAgICAgICAgIC8vICAgfVxuICAgICAgICAgICAgLy8gfSk7XG5cbiAgICAgICAgICAgIC8vIFxuXG4gICAgICAgICAgICAvLyBCaW5kIHRvIFN0YXRlQ2hhbmdlIEV2ZW50XG4gICAgICAgICAgICAvLyBIaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csJ3N0YXRlY2hhbmdlJyxmdW5jdGlvbigpeyAvLyBOb3RlOiBXZSBhcmUgdXNpbmcgc3RhdGVjaGFuZ2UgaW5zdGVhZCBvZiBwb3BzdGF0ZVxuICAgICAgICAgICAgLy8gICAgIHZhciBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGUoKTsgLy8gTm90ZTogV2UgYXJlIHVzaW5nIEhpc3RvcnkuZ2V0U3RhdGUoKSBpbnN0ZWFkIG9mIGV2ZW50LnN0YXRlXG4gICAgICAgICAgICAvLyB9KTtcblxuICAgICAgICAgICAgLy8gLy8gLy8gQ2hhbmdlIG91ciBTdGF0ZXNcbiAgICAgICAgICAgIC8vIEhpc3RvcnkucHVzaFN0YXRlKHtzdGF0ZToxfSwgXCJTdGF0ZSAxXCIsIFwiP3N0YXRlPTFcIik7IC8vIGxvZ3Mge3N0YXRlOjF9LCBcIlN0YXRlIDFcIiwgXCI/c3RhdGU9MVwiXG4gICAgICAgICAgICAvLyBIaXN0b3J5LnB1c2hTdGF0ZSh7c3RhdGU6Mn0sIFwiU3RhdGUgMlwiLCBcIj9zdGF0ZT0yXCIpOyAvLyBsb2dzIHtzdGF0ZToyfSwgXCJTdGF0ZSAyXCIsIFwiP3N0YXRlPTJcIlxuICAgICAgICAgICAgLy8gSGlzdG9yeS5yZXBsYWNlU3RhdGUoe3N0YXRlOjN9LCBcIlN0YXRlIDNcIiwgXCI/c3RhdGU9M1wiKTsgLy8gbG9ncyB7c3RhdGU6M30sIFwiU3RhdGUgM1wiLCBcIj9zdGF0ZT0zXCJcbiAgICAgICAgICAgIC8vIEhpc3RvcnkucHVzaFN0YXRlKG51bGwsIG51bGwsIFwiP3N0YXRlPTRcIik7IC8vIGxvZ3Mge30sICcnLCBcIj9zdGF0ZT00XCJcbiAgICAgICAgICAgIC8vIEhpc3RvcnkuYmFjaygpOyAvLyBsb2dzIHtzdGF0ZTozfSwgXCJTdGF0ZSAzXCIsIFwiP3N0YXRlPTNcIlxuICAgICAgICAgICAgLy8gSGlzdG9yeS5iYWNrKCk7IC8vIGxvZ3Mge3N0YXRlOjF9LCBcIlN0YXRlIDFcIiwgXCI/c3RhdGU9MVwiXG4gICAgICAgICAgICAvLyBIaXN0b3J5LmJhY2soKTsgLy8gbG9ncyB7fSwgXCJIb21lIFBhZ2VcIiwgXCI/XCJcbiAgICAgICAgICAgIC8vIEhpc3RvcnkuZ28oMik7IC8vIGxvZ3Mge3N0YXRlOjN9LCBcIlN0YXRlIDNcIiwgXCI/c3RhdGU9M1wiXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgLyogINCY0L3QuNGG0LjQsNC70LjQt9C40YDRg9C10Lwg0LrQvtC90YLQtdC50L3QtdGAINC00LvRjyDQt9Cw0L/QuNGB0LXQuSAqL1xuICAgICAgICAgICAgdmFyICRlbnRyaWVzID0gJChcIi53cmFwcGVyX19jb250ZW50XCIpO1xuXG4gICAgICAgICAgICAvKiDQktC10YjQsNC10Lwg0L7QsdGA0LDQsdC+0YLRh9C40LrQuCBvbmxpY2sg0L3QsCDRgdGB0YvQu9C60LggKi9cbiAgICAgICAgICAgIHZhciAkcGFnZV9saW5rcyA9ICQoXCIubmF2XCIpLFxuICAgICAgICAgICAgICAgICRwcmV2X2xpbmsgPSAkcGFnZV9saW5rcy5maW5kKFwiYS5uYXZfX2l0ZW1fX2xpbmtcIiksXG4gICAgICAgICAgICAgICAgJG5leHRfbGluayA9ICRwYWdlX2xpbmtzLmZpbmQoXCJhLm5hdl9faXRlbV9fbGlua1wiKTtcbiAgICAgICAgICAgICRwYWdlX2xpbmtzLmRlbGVnYXRlKFwiYVwiLCBcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSAkKHRoaXMpLmF0dHIoXCJocmVmXCIpO1xuXG4gICAgICAgICAgICAgICAgLyogINCj0LTQsNC70Y/QtdC8INGC0LXQutGD0YnQuNC1INC30LDQv9C40YHQuCDQuNC3INC60L7QvdGC0LXQudC90LXRgNCwICovXG4gICAgICAgICAgICAgICAgJGVudHJpZXMuZW1wdHkoKTtcblxuICAgICAgICAgICAgICAgIC8qICDQn9C+0LrQsNC30YvQstCw0LXQvCDQuNC90LTQuNC60LDRgtC+0YAg0LfQsNCz0YDRg9C30LrQuCAqL1xuICAgICAgICAgICAgICAgICRlbnRyaWVzLmFkZENsYXNzKFwibG9hZGluZ1wiKTtcblxuICAgICAgICAgICAgICAgIC8qICDQmCDRgdC+0L7QsdGJ0LDQtdC8IEhpc3RvcnkuanMg0L7QsSDQuNC30LzQtdC90LXQvdC40Lgg0YHQvtGB0YLQvtGP0L3QuNGPINGB0YLRgNCw0L3QuNGG0YtcbiAgICAgICAgICAgICAgICDQkiDQutCw0YfQtdGB0YLQstC1INC/0LXRgNCy0L7Qs9C+INCw0LPRgNGD0LzQtdC90YLQsCDQvNC+0LbQvdC+INC/0LXRgNC10LTQsNGC0Ywg0L/RgNC+0LjQt9Cy0L7Qu9GM0L3Ri9C5INC+0LHRitC10LrRglxuICAgICAgICAgICAgICAgINGBINC00L7Qv9C+0LvQvdC40YLQtdC70YzQvdGL0LzQuCDQtNCw0L3QvdGL0LzQuCwg0LrQvtGC0L7RgNGL0LUg0LzQvtC20L3QviDQuNC30LLQu9C10YfRjCDQsiDQvtCx0YDQsNCx0L7RgtGH0LjQutC1XG4gICAgICAgICAgICAgICAg0LjQt9C80LXQvdC10L3QuNGPINGB0L7RgdGC0L7Rj9C90LjRjywg0L7Qv9C40YHQsNC90L3QvtC8INC90LjQttC1LlxuICAgICAgICAgICAgICAgINCSINC90LDRiNC10Lwg0YHQu9GD0YfQsNC1INGN0YLQviDQsdGD0LTQtdGCINC/0YPRgdGC0L7QuSDQvtCx0YrQtdC60YIuICovXG4gICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHt9LCBudWxsLCB1cmwpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8qICDQk9C+0YLQvtCy0LjQvCDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQuNC30LzQtdC90LXQvdC40Y8g0YHQvtGB0YLQvtGP0L3QuNGPINGB0YLRgNCw0L3QuNGG0YsgKi9cbiAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csIFwic3RhdGVjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8qICDQn9C+0LvRg9GH0LDQtdC8INC40L3RhNC+0YDQvNCw0YbQuNGOINC+INGB0L7RgdGC0L7Rj9C90LjQuCDRgdGC0YDQsNC90LjRhtGLICovXG4gICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gd2luZG93Lmhpc3RvcnkuZ2V0U3RhdGUoKTtcblxuICAgICAgICAgICAgICAgIC8qINCf0L7Qu9GD0YfQsNC10LwgVVJMINC90L7QstC+0LPQviDRgdC+0YHRgtC+0Y/QvdC40Y8uINCt0YLQviBVUkwsINC60L7RgtC+0YDRi9C5INC80Ysg0L/QtdGA0LXQtNCw0LvQuFxuICAgICAgICAgICAgICAgINCyIC5wdXNoU3RhdGUoKSAqL1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzdGF0ZS51cmw7XG5cbiAgICAgICAgICAgICAgICAvKiAg0KLRg9GCINC80L7QttC90L4g0LjQt9Cy0LvQtdGH0Ywg0LTQvtC/0L7Qu9C90LjRgtC10LvRjNC90YvQtSDQtNCw0L3QvdGL0LUsINC+INC60L7RgtC+0YDRi9GFINGI0LvQsCDRgNC10YfRjCDQstGL0YjQtS5cbiAgICAgICAgICAgICAgICDQndCw0L/RgNC40LzQtdGALCDRgtCw0Lo6IHZhciBkYXRhID0gc3RhdGUuZGF0YTsgKi9cblxuICAgICAgICAgICAgICAgIC8qICDQntGC0L/RgNCw0LLQu9GP0LXQvCBBSkFYLdC30LDQv9GA0L7RgSDQvdCwINGB0LXRgNCy0LXRgC5cbiAgICAgICAgICAgICAgICDQkiDQutCw0YfQtdGB0YLQstC1INC+0YLQstC10YLQsCDQvNGLINC+0LbQuNC00LDQtdC8IEpTT04t0L7QsdGK0LXQutGCINGB0LvQtdC00YPRjtGJ0LXQs9C+INGE0L7RgNC80LDRgtCwOlxuICAgICAgICAgICAgICAgIHtlbnRyaWVzOiBcIjxhcnRpY2xlPjxoMT4uLi48L2gxPi4uLjwvYXJ0aWNsZT4gPGFydGljbGU+Li4uXCIsXG4gICAgICAgICAgICAgICAgIHRpdGxlOiBcItCh0YLRgNCw0L3QuNGG0LAgM1wiLFxuICAgICAgICAgICAgICAgICBuZXh0X3VybDogXCIvYmxvZy9wYWdlLzRcIixcbiAgICAgICAgICAgICAgICAgcHJldl91cmw6IFwiL2Jsb2cvcGFnZS8yXCIgfVxuICAgICAgICAgICAgICAgINCa0LDQutC40Lwg0L7QsdGA0LDQt9C+0Lwg0LHRg9C00LXRgiDRgdGE0L7RgNC80LjRgNC+0LLQsNC9INGN0YLQvtGCINC+0YLQstC10YIsINC30LDQstC40YHQuNGCINGC0L7Qu9GM0LrQviDQvtGCINCy0LDRgS4gKi9cbiAgICAgICAgICAgICAgICAkLmdldEpTT04odXJsLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICAvKiAg0J7QsdC90L7QstC70Y/QtdC8INC30LDQs9C+0LvQvtCy0L7QuiDRgdGC0YDQsNC90LjRhtGLICovXG4gICAgICAgICAgICAgICAgICAgICQoXCJ0aXRsZVwiKS50ZXh0KHJlc3BvbnNlLnRpdGxlKTtcblxuICAgICAgICAgICAgICAgICAgICAvKiAg0J7QsdC90L7QstC70Y/QtdC8INGB0YHRi9C70LrQuCDQvdCwINC/0YDQtdC00YvQtNGD0YnRg9GOINC4INGB0LvQtdC00YPRjtGJ0YPRjiDRgdGC0YDQsNC90LjRhtGLICovXG4gICAgICAgICAgICAgICAgICAgICRwcmV2X2xpbmsuYXR0cihcImhyZWZcIiwgcmVzcG9uc2UucHJldl91cmwpO1xuICAgICAgICAgICAgICAgICAgICAkbmV4dF9saW5rLmF0dHIoXCJocmVmXCIsIHJlc3BvbnNlLm5leHRfdXJsKTtcblxuICAgICAgICAgICAgICAgICAgICAvKiAg0JgsINC90LDQutC+0L3QtdGGLCDQv9C+0LrQsNC30YvQstCw0LXQvCDQvdC+0LLRi9C5INCx0LvQvtC6INC30LDQv9C40YHQtdC5ICovXG4gICAgICAgICAgICAgICAgICAgICRlbnRyaWVzLnJlbW92ZUNsYXNzKFwibG9hZGluZ1wiKS5odG1sKHJlc3BvbnNlLmVudHJpZXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpO1xuXG4vLyAoZnVuY3Rpb24od2luZG93LHVuZGVmaW5lZCl7XG5cbi8vICAgICAvLyBDaGVjayBMb2NhdGlvblxuLy8gICAgIGlmICggZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPT09ICdmaWxlOicgKSB7XG4vLyAgICAgICAgIGFsZXJ0KCdUaGUgSFRNTDUgSGlzdG9yeSBBUEkgKGFuZCB0aHVzIEhpc3RvcnkuanMpIGRvIG5vdCB3b3JrIG9uIGZpbGVzLCBwbGVhc2UgdXBsb2FkIGl0IHRvIGEgc2VydmVyLicpO1xuLy8gICAgIH1cblxuLy8gICAgIC8vIEVzdGFibGlzaCBWYXJpYWJsZXNcbi8vICAgICB2YXJcbi8vICAgICAgICAgSGlzdG9yeSA9IHdpbmRvdy5IaXN0b3J5LCAvLyBOb3RlOiBXZSBhcmUgdXNpbmcgYSBjYXBpdGFsIEggaW5zdGVhZCBvZiBhIGxvd2VyIGhcbi8vICAgICAgICAgU3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlKCksXG4vLyAgICAgICAgICRsb2cgPSAkKCcjbG9nJyk7XG5cbi8vICAgICAvLyBMb2cgSW5pdGlhbCBTdGF0ZVxuLy8gICAgIEhpc3RvcnkubG9nKCdpbml0aWFsOicsIFN0YXRlLmRhdGEsIFN0YXRlLnRpdGxlLCBTdGF0ZS51cmwpO1xuXG4vLyAgICAgLy8gQmluZCB0byBTdGF0ZSBDaGFuZ2Vcbi8vICAgICBIaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csJ3N0YXRlY2hhbmdlJyxmdW5jdGlvbigpeyAvLyBOb3RlOiBXZSBhcmUgdXNpbmcgc3RhdGVjaGFuZ2UgaW5zdGVhZCBvZiBwb3BzdGF0ZVxuLy8gICAgICAgICAvLyBMb2cgdGhlIFN0YXRlXG4vLyAgICAgICAgIHZhciBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGUoKTsgLy8gTm90ZTogV2UgYXJlIHVzaW5nIEhpc3RvcnkuZ2V0U3RhdGUoKSBpbnN0ZWFkIG9mIGV2ZW50LnN0YXRlXG4vLyAgICAgICAgIEhpc3RvcnkubG9nKCdzdGF0ZWNoYW5nZTonLCBTdGF0ZS5kYXRhLCBTdGF0ZS50aXRsZSwgU3RhdGUudXJsKTtcbi8vICAgICB9KTtcblxuLy8gICAgIC8vIFByZXBhcmUgQnV0dG9uc1xuLy8gICAgIHZhclxuLy8gICAgICAgICBidXR0b25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1dHRvbnMnKSxcbi8vICAgICAgICAgc2NyaXB0cyA9IFtcbi8vICAgICAgICAgICAgICdIaXN0b3J5LnB1c2hTdGF0ZSh7c3RhdGU6MSxyYW5kOk1hdGgucmFuZG9tKCl9LCBcIlN0YXRlIDFcIiwgXCI/c3RhdGU9MVwiKTsgLy8gbG9ncyB7c3RhdGU6MSxyYW5kOlwic29tZSByYW5kb20gdmFsdWVcIn0sIFwiU3RhdGUgMVwiLCBcIj9zdGF0ZT0xXCInLFxuLy8gICAgICAgICAgICAgJ0hpc3RvcnkucHVzaFN0YXRlKHtzdGF0ZToyLHJhbmQ6TWF0aC5yYW5kb20oKX0sIFwiU3RhdGUgMlwiLCBcIj9zdGF0ZT0yXCIpOyAvLyBsb2dzIHtzdGF0ZToyLHJhbmQ6XCJzb21lIHJhbmRvbSB2YWx1ZVwifSwgXCJTdGF0ZSAyXCIsIFwiP3N0YXRlPTJcIicsXG4vLyAgICAgICAgICAgICAnSGlzdG9yeS5yZXBsYWNlU3RhdGUoe3N0YXRlOjMscmFuZDpNYXRoLnJhbmRvbSgpfSwgXCJTdGF0ZSAzXCIsIFwiP3N0YXRlPTNcIik7IC8vIGxvZ3Mge3N0YXRlOjMscmFuZDpcInNvbWUgcmFuZG9tIHZhbHVlXCJ9LCBcIlN0YXRlIDNcIiwgXCI/c3RhdGU9M1wiJyxcbi8vICAgICAgICAgICAgICdIaXN0b3J5LnB1c2hTdGF0ZShudWxsLCBudWxsLCBcIj9zdGF0ZT00XCIpOyAvLyBsb2dzIHt9LCBcIlwiLCBcIj9zdGF0ZT00XCInLFxuLy8gICAgICAgICAgICAgJ0hpc3RvcnkuYmFjaygpOyAvLyBsb2dzIHtzdGF0ZTozfSwgXCJTdGF0ZSAzXCIsIFwiP3N0YXRlPTNcIicsXG4vLyAgICAgICAgICAgICAnSGlzdG9yeS5iYWNrKCk7IC8vIGxvZ3Mge3N0YXRlOjF9LCBcIlN0YXRlIDFcIiwgXCI/c3RhdGU9MVwiJyxcbi8vICAgICAgICAgICAgICdIaXN0b3J5LmJhY2soKTsgLy8gbG9ncyB7fSwgXCJUaGUgcGFnZSB5b3Ugc3RhcnRlZCBhdFwiLCBcIj9cIicsXG4vLyAgICAgICAgICAgICAnSGlzdG9yeS5nbygyKTsgLy8gbG9ncyB7c3RhdGU6M30sIFwiU3RhdGUgM1wiLCBcIj9zdGF0ZT0zXCInXG4vLyAgICAgICAgIF0sXG4vLyAgICAgICAgIGJ1dHRvbnNIVE1MID0gJydcbi8vICAgICAgICAgO1xuXG4vLyAgICAgLy8gQWRkIEJ1dHRvbnNcbi8vICAgICBmb3IgKCB2YXIgaT0wLG49c2NyaXB0cy5sZW5ndGg7IGk8bjsgKytpICkge1xuLy8gICAgICAgICB2YXIgX3NjcmlwdCA9IHNjcmlwdHNbaV07XG4vLyAgICAgICAgIGJ1dHRvbnNIVE1MICs9XG4vLyAgICAgICAgICAgICAnPGxpPjxidXR0b24gb25jbGljaz1cXCdqYXZhc2NyaXB0OicrX3NjcmlwdCsnXFwnPicrX3NjcmlwdCsnPC9idXR0b24+PC9saT4nO1xuLy8gICAgIH1cbi8vICAgICBidXR0b25zLmlubmVySFRNTCA9IGJ1dHRvbnNIVE1MO1xuXG4vLyB9KSh3aW5kb3cpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGFwcC5wcmVsb2FkID0ge1xuXG4gICAgICAgIHByZWxvYWQ6IGZ1bmN0aW9uKCRpbWFnZSlcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIHVybCA9ICRpbWFnZS5kYXRhKCdwcmVsb2FkJyksIGltYWdlID0gbnVsbDtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgICAgIGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkaW1hZ2UuYXR0cignc3JjJywgdXJsKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGltYWdlLnNyYyA9IHVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgJGltYWdlLmF0dHIoJ3NyYycsIHVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRpbWFnZS5yZW1vdmVBdHRyKCd3aWR0aCBoZWlnaHQnKTtcbiAgICAgICAgICAgICRpbWFnZS5kYXRhKCdwcmVsb2FkJywgJycpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKCQoJ2ltZ1tkYXRhLXByZWxvYWRdJykubGVuZ3RoKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAkKCdpbWdbZGF0YS1wcmVsb2FkXScpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCRpbWFnZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcmVsb2FkKCRpbWFnZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pKCQodGhpcykpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGFwcC5xdWFudGl0eSA9IHtcblxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIGVsZW1lbnQ6ICcuai1xdWFudGl0eScsXG4gICAgICAgICAgICBpbnB1dDogJy5qLXF1YW50aXR5LWNvdW50JyxcbiAgICAgICAgICAgIGNvbnRyb2w6ICcuai1xdWFudGl0eS1jb250cm9sJyxcbiAgICAgICAgICAgIGNvbXBsZXRlOiBudWxsXG4gICAgICAgIH0sXG5cbiAgICAgICAgZWxlbWVudDogbnVsbCxcblxuICAgICAgICBleHRlbmQ6IGZ1bmN0aW9uKGNvbmZpZylcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciB4O1xuICAgICAgICAgICAgICAgIGZvciAoeCBpbiBjb25maWcpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIF90aGlzLmNvbmZpZ1t4XSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb25maWdbeF0gPSBjb25maWdbeF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbihxdWFudGl0eSlcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIG1pbiA9IDEsIG1heCA9IDEwMDtcblxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5kYXRhKCdtaW4nKSkge1xuICAgICAgICAgICAgICAgIG1pbiA9IHRoaXMuZWxlbWVudC5kYXRhKCdtaW4nKTsgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5kYXRhKCdtYXgnKSkge1xuICAgICAgICAgICAgICAgIG1heCA9IHRoaXMuZWxlbWVudC5kYXRhKCdtYXgnKTsgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHF1YW50aXR5ID4gbWF4KSB7XG4gICAgICAgICAgICAgICAgcXVhbnRpdHkgPSBtYXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChxdWFudGl0eSA8IG1pbikge1xuICAgICAgICAgICAgICAgIHF1YW50aXR5ID0gbWluO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZCh0aGlzLmNvbmZpZy5pbnB1dCkudmFsKHF1YW50aXR5KTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIGluY3JlYXNlOiBmdW5jdGlvbihxdWFudGl0eSlcbiAgICAgICAge1xuICAgICAgICAgICAgcXVhbnRpdHkgKz0gMTtcblxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShxdWFudGl0eSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVjcmVhc2U6IGZ1bmN0aW9uKHF1YW50aXR5KVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAocXVhbnRpdHkgPiAxKSB7XG4gICAgICAgICAgICAgICAgcXVhbnRpdHkgLT0gMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShxdWFudGl0eSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKHR5cGVvZih0aGlzLmVsZW1lbnQuZGF0YSgncHJvZHVjdCcpKSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mKHRoaXMuY29uZmlnLmNvbXBsZXRlKSA9PSAnZnVuY3Rpb24nKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmNvbXBsZXRlLmNhbGwobnVsbCwgdGhpcy5lbGVtZW50LCB0aGlzLmVsZW1lbnQuZGF0YSgncHJvZHVjdCcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBrZXlzOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXMsIHJvbGUgPSAnJztcblxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdrZXlkb3duJywgX3RoaXMuY29uZmlnLmlucHV0LCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKFszOCwgNDBdLmluZGV4T2YoZS5rZXlDb2RlKSA+PSAwKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJvbGUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAzODogJ2luY3JlYXNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIDQwOiAnZGVjcmVhc2UnXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZWxlbWVudCA9ICQodGhpcykuY2xvc2VzdChfdGhpcy5jb25maWcuZWxlbWVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgX3RoaXNbcm9sZVtlLmtleUNvZGVdXShwYXJzZUludChfdGhpcy5lbGVtZW50LmZpbmQoX3RoaXMuY29uZmlnLmlucHV0KS52YWwoKSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNhbGxiYWNrKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJpbmQ6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcywgcm9sZSA9ICcnO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgX3RoaXMuY29uZmlnLmNvbnRyb2wsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBfdGhpcy5lbGVtZW50ID0gJCh0aGlzKS5jbG9zZXN0KF90aGlzLmNvbmZpZy5lbGVtZW50KTtcblxuICAgICAgICAgICAgICAgIHJvbGUgPSAkKHRoaXMpLmRhdGEoJ3JvbGUnKTtcbiAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKFsnaW5jcmVhc2UnLCAnZGVjcmVhc2UnXS5pbmRleE9mKHJvbGUpID49IDApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBfdGhpc1tyb2xlXShwYXJzZUludChfdGhpcy5lbGVtZW50LmZpbmQoX3RoaXMuY29uZmlnLmlucHV0KS52YWwoKSkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIF90aGlzLmNhbGxiYWNrKCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbihjb25maWcpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV4dGVuZChjb25maWcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmJpbmQoKTtcbiAgICAgICAgICAgIHRoaXMua2V5cygpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG59KShkb2N1bWVudC5ib2R5KTtcblxuLy8gdGhpcy5xdWFudGl0eS5pbml0KHtcbi8vICAgICBjb21wbGV0ZTogZnVuY3Rpb24oZWxlbWVudCwgaWQpIHtcbi8vICAgICAgICAgLy8gJChlbGVtZW50KS5jc3Moe1xuLy8gICAgICAgICAvLyAgICAgJ2JvcmRlcic6ICcxcHggc29saWQgbGltZSdcbi8vICAgICAgICAgLy8gfSk7XG5cbi8vICAgICAgICAgY29uc29sZS5sb2coXCJpZCA6XCIsIGlkKTtcbi8vICAgICB9XG4vLyB9KTtcblxuLy8gPGRpdiBjbGFzcz1cInF1YW50aXR5IGotcXVhbnRpdHkgY2xlYXJmaXhcIiBkYXRhLXByb2R1Y3Q9XCIxMDAwXCIgZGF0YS1taW49XCIxXCIgZGF0YS1tYXg9XCI5OTlcIj5cbi8vICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cInF1YW50aXR5X19jb250cm9sIF9kZWNyZWFzZSBqLXF1YW50aXR5LWNvbnRyb2xcIiBkYXRhLXJvbGU9XCJkZWNyZWFzZVwiPjwvYnV0dG9uPlxuLy8gICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIG5hbWU9XCJjb3VudFsxMDAwXVwiIHZhbHVlPVwiMVwiIGRhdGEtcm9sZT1cInF1YW50aXR5LWlucHV0XCIgY2xhc3M9XCJxdWFudGl0eV9fY291bnQgai1xdWFudGl0eS1jb3VudFwiIG1heGxlbmd0aD1cIjNcIiBhdXRvY29tcGxldGU9XCJvZmZcIj5cbi8vICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cInF1YW50aXR5X19jb250cm9sIF9pbmNyZWFzZSBqLXF1YW50aXR5LWNvbnRyb2xcIiBkYXRhLXJvbGU9XCJpbmNyZWFzZVwiPjwvYnV0dG9uPlxuLy8gPC9kaXY+IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuOyhmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBfdGhpcztcblxuICAgIGFwcC5zYW5kd2ljaCA9IHtcblxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIGtleUhvb2tzOiAhMSxcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnLmpzLXNhbmR3aWNoLW1lbnUnLFxuICAgICAgICAgICAgd3JhcHBlcjogJy5sYXlvdXQtd3JhcHBlcicsXG4gICAgICAgICAgICBvdmVybGF5OiAnLm92ZXJsYXknXG4gICAgICAgIH0sXG5cbiAgICAgICAgZXh0ZW5kOiBmdW5jdGlvbihjb25maWcpXG4gICAgICAgIHtcbiAgICAgICAgICAgIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciB4O1xuICAgICAgICAgICAgICAgIGZvciAoeCBpbiBjb25maWcpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIF90aGlzLmNvbmZpZ1t4XSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb25maWdbeF0gPSBjb25maWdbeF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzT3BlbjogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gJCgnYm9keScpLmhhc0NsYXNzKCdwYWdlLXZpc2libGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygncGFnZS1vcGVuJyk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3BhZ2UtdmlzaWJsZScpO1xuICAgICAgICAgICAgfSwgMTApO1xuXG4gICAgICAgICAgICAkKHRoaXMuY29uZmlnLm92ZXJsYXkpLmNzcyh7XG4gICAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknOiAnaGlkZGVuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3BhZ2UtdmlzaWJsZScpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygncGFnZS1vcGVuJyk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygncGFnZS12aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ3BhZ2Utb3BlbicpO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ3BhZ2UtdmlzaWJsZScpO1xuICAgICAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHZpc2liaWxpdHkgPSAndmlzaWJsZSc7XG5cbiAgICAgICAgICAgIGlmICghJCgnYm9keScpLmhhc0NsYXNzKCdwYWdlLW9wZW4nKSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5ID0gJ2hpZGRlbidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJChfdGhpcy5jb25maWcub3ZlcmxheSkuY3NzKHtcbiAgICAgICAgICAgICAgICAndmlzaWJpbGl0eSc6IHZpc2liaWxpdHlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNhbmR3aWNoVHJpZ2dlcjogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmIChfdGhpcy5jb25maWcua2V5SG9va3MpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJCgnYm9keScpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZihlLmtleUNvZGUgPT0gMjcgJiYgX3RoaXMuaXNPcGVuKCkpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnRvZ2dsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgX3RoaXMuY29uZmlnLnNlbGVjdG9yLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0ID8gZS5wcmV2ZW50RGVmYXVsdCgpIDogZS5yZXR1cm5WYWx1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIF90aGlzLnRvZ2dsZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3ZlcmxheVRyaWdnZXI6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgX3RoaXMuY29uZmlnLm92ZXJsYXksIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIF90aGlzLmhpZGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKGNvbmZpZylcbiAgICAgICAge1xuICAgICAgICAgICAgdGhpcy5leHRlbmQoY29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMuc2FuZHdpY2hUcmlnZ2VyKCk7XG4gICAgICAgICAgICB0aGlzLm92ZXJsYXlUcmlnZ2VyKCk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGFwcC50YWJzID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICR3cmFwcGVyID0gbnVsbCwgdGFiID0gJyc7XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnLmotdGFiLXRyaWdnZXInLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoISQodGhpcykuaGFzQ2xhc3MoJ19vcGVuJykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiID0gJCh0aGlzKS5kYXRhKCd0YWInKTtcblxuICAgICAgICAgICAgICAgICAgICAkd3JhcHBlciA9ICQodGhpcykuY2xvc2VzdCgnLmotdGFiLXdyYXBwZXInKTtcblxuICAgICAgICAgICAgICAgICAgICAkd3JhcHBlci5maW5kKCcuai10YWItdHJpZ2dlcicpLnJlbW92ZUNsYXNzKCdfY3VycmVudCcpO1xuICAgICAgICAgICAgICAgICAgICAkd3JhcHBlci5maW5kKCcuai10YWItaXRlbScpLnJlbW92ZUNsYXNzKCdfb3BlbicpO1xuXG4gICAgICAgICAgICAgICAgICAgICR3cmFwcGVyLmZpbmQoJyN0YWItJyt0YWIpLmFkZENsYXNzKCdfb3BlbicpO1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdfY3VycmVudCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG59KShkb2N1bWVudC5ib2R5KTsiLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICBhcHAudG9nZ2xlID0ge1xuICAgICAgICBcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciAkdG9nZ2xlID0gbnVsbCwgdGV4dCA9ICcnLCBoaWRlID0gdHJ1ZSwgcmVtb3ZlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnLmotdG9nZ2xlLXRyaWdnZXInLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAkdG9nZ2xlID0gJCh0aGlzKS5jbG9zZXN0KCcuai10b2dnbGUnKS5maW5kKCcuai10b2dnbGUtaXRlbScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0b2dnbGUpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAkdG9nZ2xlLnRvZ2dsZUNsYXNzKCdpcy1zaG93Jyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCR0b2dnbGUuaGFzQ2xhc3MoJ2lzLWhpZGRlbicpKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJHRvZ2dsZS5yZW1vdmVDbGFzcygnaXMtaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuZGF0YSgndG9nZ2xlLXRleHQnKSkge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5kYXRhKCd0b2dnbGUtdGV4dCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoJCh0aGlzKS5kYXRhKCdyZW1vdmUnKSkgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZSA9ICQodGhpcykuZGF0YSgncmVtb3ZlJykgPT0gJzAnID8gZmFsc2UgOiAoJCh0aGlzKS5kYXRhKCdyZW1vdmUnKSA9PSAnMScgPyB0cnVlIDogZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoaGlkZSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHJlbW92ZSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZGF0YSgndG9nZ2xlLXRleHQnLCAkKHRoaXMpLmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuaHRtbCh0ZXh0KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpO1xuXG4vLyA8ZGl2IGNsYXNzPVwiai10b2dnbGVcIj5cbi8vICAgICA8ZGl2IGNsYXNzPVwiai10b2dnbGUtaXRlbVwiPiBjb250ZW50IDwvZGl2PlxuLy8gICAgIDxzcGFuIGNsYXNzPVwiai10b2dnbGUtdHJpZ2dlclwiIGRhdGEtdG9nZ2xlLXRleHQ9XCLQodC60YDRi9GC0YwuLi5cIiBkYXRhLWhpZGU9XCIxXCIgZGF0YS1yZW1vdmU9XCIxXCI+0JXRidC1Li4uPC9zcGFuPlxuLy8gPC9kaXY+IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIF9fKCkge3RyeSB7Zm9yKHZhciBpPTA7IGk8YXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7Y29uc29sZS5sb2coYXJndW1lbnRzW2ldKTt9fWNhdGNoIChlKSB7fX1cblxuZnVuY3Rpb24gc3ByaW50Zih2KSB7XG4gIHZhciBzcGxpdCA9IHYudG9TdHJpbmcoKS5zcGxpdCgnLicpLCBwYWQgPSBcIjAwXCIsIHRpbWUgPSBbXSwgeCA9IG51bGw7XG5cbiAgZm9yICh4IGluIHNwbGl0KSB7XG4gICAgdGltZS5wdXNoKHBhZC5zdWJzdHJpbmcoMCwgMiAtIHNwbGl0W3hdLnRvU3RyaW5nKCkubGVuZ3RoKSArIHNwbGl0W3hdKTtcbiAgfVxuXG4gIHJldHVybiB0aW1lLmpvaW4oJy4nKTtcbn0iLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICBhcHAuaW5pdCgpO1xufSk7Il19
